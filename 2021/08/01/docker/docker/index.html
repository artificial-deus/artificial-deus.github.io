<!DOCTYPE html><html lang="cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>docker 学习笔记 | Akachi's blog</title><meta name="keywords" content="容器化,docker"><meta name="author" content="Akachi"><meta name="copyright" content="Akachi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="docker 学习笔记安装资源linux安装 ubuntu 解决ssh没有问题 sudo service ssh start 解决 ifconfig 没有问题 sudo apt-get install net-tools 安装docker命令 URL:https:&#x2F;&#x2F;www.runoob.com&#x2F;docker&#x2F;ubuntu-docker-install.html  windows安装 URL:ht">
<meta property="og:type" content="article">
<meta property="og:title" content="docker 学习笔记">
<meta property="og:url" content="https://artificial-deus.github.io/2021/08/01/docker/docker/index.html">
<meta property="og:site_name" content="Akachi&#39;s blog">
<meta property="og:description" content="docker 学习笔记安装资源linux安装 ubuntu 解决ssh没有问题 sudo service ssh start 解决 ifconfig 没有问题 sudo apt-get install net-tools 安装docker命令 URL:https:&#x2F;&#x2F;www.runoob.com&#x2F;docker&#x2F;ubuntu-docker-install.html  windows安装 URL:ht">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/akachi10/blog-pic/main/5.jpg">
<meta property="article:published_time" content="2021-08-02T06:00:42.000Z">
<meta property="article:modified_time" content="2023-03-09T03:11:43.205Z">
<meta property="article:author" content="Akachi">
<meta property="article:tag" content="容器化">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/akachi10/blog-pic/main/5.jpg"><link rel="shortcut icon" href="https://raw.githubusercontent.com/akachi10/notes/master/god_dice.jfif"><link rel="canonical" href="https://artificial-deus.github.io/2021/08/01/docker/docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a04e00a053a6685b9b86ca842f0f2e2f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-BGTJN89SV4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BGTJN89SV4');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"FCSTQQ895M","apiKey":"72acbaa4c88844d34550b999e19531f0","indexName":"blog-search","hits":{"per_page":6},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker 学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-08 19:11:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://avatars.githubusercontent.com/u/38939292?s=60&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">37</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">52</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">28</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/akachi10/blog-pic/main/5.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Akachi's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">docker 学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-08-02T06:00:42.000Z" title="Created 2021-08-01 23:00:42">2021-08-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-03-09T03:11:43.205Z" title="Updated 2023-03-08 19:11:43">2023-03-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%B9%E5%99%A8%E5%8C%96/">容器化</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker 学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="docker-学习笔记"><a href="#docker-学习笔记" class="headerlink" title="docker 学习笔记"></a>docker 学习笔记</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><h4 id="linux安装-ubuntu"><a href="#linux安装-ubuntu" class="headerlink" title="linux安装 ubuntu"></a>linux安装 ubuntu</h4><ul>
<li>解决ssh没有问题</li>
<li>sudo service ssh start</li>
<li>解决 ifconfig 没有问题</li>
<li>sudo apt-get install net-tools</li>
<li>安装docker命令</li>
<li>URL:<a target="_blank" rel="noopener" href="https://www.runoob.com/docker/ubuntu-docker-install.html">https://www.runoob.com/docker/ubuntu-docker-install.html</a></li>
</ul>
<h4 id="windows安装"><a href="#windows安装" class="headerlink" title="windows安装"></a>windows安装</h4><ul>
<li>URL:<a target="_blank" rel="noopener" href="https://www.runoob.com/docker/windows-docker-install.html">https://www.runoob.com/docker/windows-docker-install.html</a></li>
<li>Windows wsl2 问题解决 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39806603/article/details/111166146">https://blog.csdn.net/weixin_39806603/article/details/111166146</a><ul>
<li>在powershell中执行</li>
<li>Enable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform</li>
<li>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</li>
<li>并且到Windows官网中(以下链接)中在”步骤4的1.下载最新包”下载安装包</li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10">https://docs.microsoft.com/zh-cn/windows/wsl/install-win10</a></li>
</ul>
</li>
</ul>
<h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><ul>
<li>官方文档在这</li>
</ul>
<p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210413211446239.png" alt="image-20210413211446239"></p>
<ul>
<li>位置</li>
</ul>
<p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210413211846809.png" alt="image-20210413211846809"></p>
<h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、安装包</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、用国内的仓库y</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash">国外</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3、安装docker引擎</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.1、更新索引</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4、 安装docker相关的 docker-ce是社区版 ee是企业版</span></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5、启动docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6、使用docker version查看是否安装成功</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6.5、使用 docker login登陆dockerhub</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 7、运行hello world</span></span><br><span class="line">docker run --rm hello-world</span><br><span class="line"><span class="meta">#</span><span class="bash"> 8、查看 hello image</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 9、关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure>

<h4 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、卸载依赖</span></span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、删除资源</span></span><br><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br><span class="line"><span class="meta">#</span><span class="bash"> /var/lib/docker docker的默认工作路径</span></span><br></pre></td></tr></table></figure>

<h4 id="使用加速器"><a href="#使用加速器" class="headerlink" title="使用加速器"></a>使用加速器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、阿里云docker加速器配置文件</span></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://s796m7v3.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="docker-原理"><a href="#docker-原理" class="headerlink" title="docker 原理"></a>docker 原理</h2><h3 id="调用hello时系统做了什么"><a href="#调用hello时系统做了什么" class="headerlink" title="调用hello时系统做了什么"></a>调用hello时系统做了什么</h3><p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210414095356937.png" alt="image-20210414095356937"></p>
<h3 id="docker-是怎么工作的"><a href="#docker-是怎么工作的" class="headerlink" title="docker 是怎么工作的"></a>docker 是怎么工作的</h3><p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210414100919038.png" alt="image-20210414100919038"></p>
<h3 id="docker-为什么比VM快"><a href="#docker-为什么比VM快" class="headerlink" title="docker 为什么比VM快"></a>docker 为什么比VM快</h3><p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210414102011258.png" alt="image-20210414102011258"></p>
<ul>
<li>虚拟机流程<ul>
<li>OS 硬件虚拟层 1-1 虚拟机libs 1-1 app</li>
</ul>
</li>
<li>docker流程 <ul>
<li>lib 1-* 系统 </li>
</ul>
</li>
</ul>
<h2 id="docker中的概念"><a href="#docker中的概念" class="headerlink" title="docker中的概念"></a>docker中的概念</h2><h3 id="docker-分层下载"><a href="#docker-分层下载" class="headerlink" title="docker 分层下载"></a>docker 分层下载</h3><ul>
<li><p>UnionFS</p>
<p>分层的文件系统就好比我们使用git下载代码</p>
<p>并不是每次都需要下载所有的代买只需要下载最新更新的那部分我们差的就可以了。</p>
<ul>
<li><p>Layers 每个层在系统中都是一个Layers </p>
<p>Layers我们不应该理解为一个文件而应该理解为一系列操作也可以是删除或修改其中的内容。</p>
<p>比如如下的一个例子中我们有一个自研系统。其中MySQL也是非标的那么我先按照MySQL作为一个层而自研系统作为另一个层</p>
</li>
</ul>
<p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210505214716880.png" alt="image-20210505214716880"></p>
<p>如果我们要对这个系统进行升级那么会出现以下情况</p>
<p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210505214824616.png" alt="image-20210505214824616"></p>
<p>在这种情况下一个已经使用过我们自研系统的用户是不需要下载Layers 0中的内容的</p>
<p>而只需要下载Layers 2 而实际上我们也可以直接基于Layers0上构建系统这样即便是新也不需要下载Layers1了</p>
</li>
</ul>
<h3 id="docker中的镜像"><a href="#docker中的镜像" class="headerlink" title="docker中的镜像"></a>docker中的镜像</h3><p>就是一个软件包吧环境、变量、等等打包在一起运行的镜像</p>
<p>如何得到镜像</p>
<ul>
<li><p>远程下载</p>
</li>
<li><p>拷贝</p>
</li>
<li><p>自己制作一个镜像</p>
</li>
</ul>
<h2 id="IDEA-docker-插件"><a href="#IDEA-docker-插件" class="headerlink" title="IDEA docker 插件"></a>IDEA docker 插件</h2><h3 id="开启docker-的TCP控制"><a href="#开启docker-的TCP控制" class="headerlink" title="开启docker 的TCP控制"></a>开启docker 的TCP控制</h3><blockquote>
<p>查找docker.service文件位置</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@test01 ~]# systemctl status docker</span><br></pre></td></tr></table></figure>

<ul>
<li><p>windows</p>
<blockquote>
<p>点击按钮打开TCP守护进程</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/08/26/230130.png" alt="image-20210826230121094"></p>
</li>
<li><p>linux</p>
<blockquote>
<p>LINUX 修改/usr/lib/systemd/system/docker.service中的ExecStart参数</p>
<p>加入-H tcp:0.0.0.0:2375 -H  unix:///var/run/docker.sock </p>
<p>ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock -H fd:// –containerd=/run/containerd/containerd.sock</p>
</blockquote>
<ul>
<li><p>重启服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@test01 ~]# systemctl daemon-reload</span><br><span class="line">[root@test01 ~]# systemctl restart docker</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>测试端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">telnet localhsot 2375</span><br><span class="line">curl http://192.168.1.171:2375/version</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果发现远程无法连接需要关闭防火墙</p>
</blockquote>
</li>
</ul>
<h3 id="IDEA中配置"><a href="#IDEA中配置" class="headerlink" title="IDEA中配置"></a>IDEA中配置</h3><ul>
<li><p>添加连接</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/08/26/232821.png" alt="image-20210826232820767"></p>
<blockquote>
<p>Build,Execution,Deployment&gt;&gt;找到Docker&gt;&gt;+</p>
</blockquote>
</li>
<li><p>打开Services</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/08/27/005600.png" alt="image-20210827005559337"></p>
</li>
<li><p>在Services面板中能看到docker了</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/08/27/005752.png" alt="image-20210827005750933"></p>
</li>
<li><p>配置镜像服务器</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/08/27/010318.png" alt="image-20210827010317261"></p>
</li>
</ul>
<h3 id="集成maven插件"><a href="#集成maven插件" class="headerlink" title="集成maven插件"></a>集成maven插件</h3><blockquote>
<p>在pox.xml&gt;properties中加入docker的前缀</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;docker.image.prefix&gt;rainbowfish&lt;/docker.image.prefix&gt;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>在pom.xml中加入一个plugins 不适用DockerFile的情况下</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">imageName</span>&gt;</span>192.168.2.129:5000/clairvoyance/listener:1.0<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">baseImage</span>&gt;</span>openjdk:8-jre-slim<span class="tag">&lt;/<span class="name">baseImage</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maintainer</span>&gt;</span>docker_maven zsts@hotmail.com<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">workdir</span>&gt;</span>/ROOT<span class="tag">&lt;/<span class="name">workdir</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entryPoint</span>&gt;</span>[&quot;java&quot;, &quot;-jar&quot;, &quot;$&#123;project.build.finalName&#125;.jar&quot;]<span class="tag">&lt;/<span class="name">entryPoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exposes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">expose</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">expose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exposes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>/ROOT<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>编写Dockerfile</p>
<blockquote>
<p>创建Dockerfile 到项目根路径下指定的目录下。</p>
</blockquote>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jre-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> akachi zsts@hotmail.com</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /ROOT</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> target/listener-0.0.1-SNAPSHOT.jar app.jar</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> src/main/resources/application-*.properties .</span></span><br><span class="line"><span class="keyword">ENV</span> PROFILES_ACTIVE pro</span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;listener-*-SNAPSHOT.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>依次执行maven命令</p>
</li>
<li><p>编写一个docker-compose.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">listener:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.129</span><span class="string">:5000/clairvoyance/listener:1.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PROFILES_ACTIVE=pro</span></span><br></pre></td></tr></table></figure></li>
<li><ul>
<li>clean</li>
<li>package</li>
<li>Plugins-&gt;docker-&gt;docker:build</li>
</ul>
</li>
</ul>
<blockquote>
<p>解决问题:</p>
<ol>
<li><p>not find database.class什么的</p>
<p>由于jdk11之后去掉了这些内容需要单独在plugin标签里加入jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>docker 找不到文件</p>
<p>由于docker build 是将当前目录下所有内容发送给docker daemon所以不能访问上层目录。</p>
<p>解决方案，将dockerfile放到顶层。</p>
</li>
<li><p>Failed to execute goal com.spotify:docker-maven-plugin:1.0.0:build (default-cli) on project product: Exception caught</p>
<p>因为没有jar文件</p>
</li>
</ol>
</blockquote>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="资源地址"><a href="#资源地址" class="headerlink" title="资源地址"></a>资源地址</h3><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="left">地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">官方网址</td>
<td align="left"><a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></td>
</tr>
<tr>
<td align="center">仓库地址</td>
<td align="left"><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></td>
</tr>
</tbody></table>
<h3 id="名词概念"><a href="#名词概念" class="headerlink" title="名词概念"></a>名词概念</h3><table>
<thead>
<tr>
<th>英文</th>
<th>翻译</th>
<th>命令</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Hyper-V</td>
<td>Hyper-V</td>
<td>—</td>
<td>微软虚拟机相当于VM</td>
</tr>
<tr>
<td>PowerShell</td>
<td>PowerShell</td>
<td>—</td>
<td>微软的shell</td>
</tr>
<tr>
<td>repository</td>
<td>仓库</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>containers</td>
<td>容器</td>
<td>—</td>
<td></td>
</tr>
</tbody></table>
<h3 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">循环命令</span><br><span class="line">i=0 ; while true ;do i=$(($i+1));sleep 1s;echo $&#123;i&#125;;done</span><br></pre></td></tr></table></figure>



<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><h4 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h4><h5 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a>docker images</h5><ul>
<li><p>docker images 查看主机上的镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">hello-world   latest    d1165f221234   5 weeks ago   13.3kB</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">解释</span></span><br><span class="line">REPOSITORY    镜像仓库源</span><br><span class="line">TAG           镜像的标签</span><br><span class="line">IMAGE ID      ID</span><br><span class="line">CREATED       创建时间</span><br><span class="line">SIZE          大小</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line">-a            #列出所有镜像</span><br><span class="line">-f            #过滤</span><br><span class="line">-q            #镜像的ID（用于情况）</span><br><span class="line">-aq           #所有镜像</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h5><ul>
<li><p>docker search 搜索命令 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker search mysql</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   10748     [OK]</span><br><span class="line">mariadb                           MariaDB Server is a high performing open sou…   4047      [OK]</span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   791                  [OK]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line"> -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print search using a Go template</span><br><span class="line">      --limit int       Max number of search results (default 25)</span><br><span class="line">      --no-trunc        Don&#x27;t truncate output</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">可选项注释</span></span><br><span class="line">-f STARS=2000</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h5><ul>
<li><p>docker pull 下载镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">  #</span><span class="bash"> docker pull mysql</span> 	</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">f7ec5a41d630: Pull complete</span><br><span class="line">9444bb562699: Pull complete</span><br><span class="line">6a4207b96940: Pull complete</span><br><span class="line">181cefd361ce: Pull complete</span><br><span class="line">8a2090759d8a: Pull complete</span><br><span class="line">15f235e0d7ee: Extracting [==============&gt;                                    ]  3.932MB/13.45MB</span><br><span class="line"></span><br><span class="line">docker.io/library/mysql:latest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">可选项</span></span><br><span class="line">-a, --all-tags                Download all tagged images in the repository</span><br><span class="line">    --disable-content-trust   Skip image verification (default true)</span><br><span class="line">    --platform string         Set platform if server is multi-platform capable</span><br><span class="line">-q, --quiet                   Suppress verbose output</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">备注</span></span><br><span class="line">docker.io/library/mysql:latest是真实地址</span><br><span class="line">docker pull docker.io/library/mysql:latest 等同于 docker pull mysql</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-rm-rmi"><a href="#docker-rm-rmi" class="headerlink" title="docker rm rmi"></a>docker rm rmi</h5><ul>
<li><p>docker rm|rmi</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker rmi mysql:5.7</span></span><br><span class="line">Untagged: mysql:5.7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">可选项</span></span><br><span class="line">  -f, --force      Force removal of the image</span><br><span class="line">      --no-prune   Do not delete untagged parents</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">docker rmi -f $(docker images -aq)</span></span><br><span class="line">删除所有</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-history"><a href="#docker-history" class="headerlink" title="docker history"></a>docker history</h5><ul>
<li><p>docker history</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker history mysql</span><br><span class="line">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT</span><br><span class="line">c0cdc95609f1   4 weeks ago   /bin/sh -c #(nop)  CMD [&quot;mysqld&quot;]               0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop)  EXPOSE 3306 33060            0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop)  ENTRYPOINT [&quot;docker-entry…   0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c ln -s usr/local/bin/docker-entryp…   34B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop) COPY file:345a22fe55d3e678…   14.5kB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop) COPY dir:2e040acc386ebd23b…   1.12kB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop)  VOLUME [/var/lib/mysql]      0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c &#123;   echo mysql-community-server m…   420MB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c echo &#x27;deb http://repo.mysql.com/a…   55B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop)  ENV MYSQL_VERSION=8.0.25-…   0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop)  ENV MYSQL_MAJOR=8.0          0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c set -ex;  key=&#x27;A4A9406876FCBD3C45…   2.61kB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c apt-get update &amp;&amp; apt-get install…   52.2MB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c mkdir /docker-entrypoint-initdb.d    0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c set -eux;  savedAptMark=&quot;$(apt-ma…   4.17MB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop)  ENV GOSU_VERSION=1.12        0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c apt-get update &amp;&amp; apt-get install…   9.34MB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c groupadd -r mysql &amp;&amp; useradd -r -…   329kB</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B</span><br><span class="line">&lt;missing&gt;      4 weeks ago   /bin/sh -c #(nop) ADD file:7362e0e50f30ff454…   69.3MB</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-tag-重命名镜像"><a href="#docker-tag-重命名镜像" class="headerlink" title="docker tag 重命名镜像"></a>docker tag 重命名镜像</h5><p>​    这会Copy出一个镜像来</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker tag --help</span><br><span class="line"></span><br><span class="line">Usage:  docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br><span class="line"></span><br><span class="line">Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br></pre></td></tr></table></figure>



<h5 id="docker-save"><a href="#docker-save" class="headerlink" title="docker save"></a>docker save</h5><p>保存镜像文件</p>
<h5 id="docker-load"><a href="#docker-load" class="headerlink" title="docker load"></a>docker load</h5><p>载入镜像文件</p>
<h5 id="docker-import"><a href="#docker-import" class="headerlink" title="docker import"></a>docker import</h5><p>载入容器成为镜像文件</p>
<h4 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h4><h5 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h5><ul>
<li><p>docker run</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run [可选参数] image</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">可选参数</span></span><br><span class="line">-- name=&quot;Name&quot; 容器名字</span><br><span class="line">-d 后台方式运行 nohup</span><br><span class="line">-it 交互方式运行，进入容器查看内容</span><br><span class="line">-p 指定容器端口 8080:8083</span><br><span class="line">  	-p 容器端口</span><br><span class="line">  	-p ip:port:容器端口	</span><br><span class="line">-v dir:dir 挂载卷</span><br><span class="line">-e PROFILES_ACTIVE=com</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动并进入容器</span></span><br><span class="line">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@1b15ac179c28 /]#</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-ps"><a href="#docker-ps" class="headerlink" title="docker ps"></a>docker ps</h5><ul>
<li><p>查看正在运行的命令 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS                        PORTS     NAMES</span><br><span class="line">1b15ac179c28   centos    &quot;/bin/bash&quot;   15 minutes ago   Exited (0) 12   minutes ago             magical_mayer</span><br><span class="line"></span><br><span class="line">-a 列出当前正在运行的容器+ 历史运行过得程序</span><br><span class="line">-n=1 显示最近运行的1个程序</span><br><span class="line">-q 只显示编号</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Ctrl-P-Q"><a href="#Ctrl-P-Q" class="headerlink" title="Ctrl+P+Q"></a>Ctrl+P+Q</h5><ul>
<li><p>容器不停止退出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+P+Q # 容器不停止退出</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-rm"><a href="#docker-rm" class="headerlink" title="docker rm"></a>docker rm</h5><ul>
<li><p>删除命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker rm $(docker ps -aq)</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">查询后删除命令</span></span><br><span class="line">docker ps -a -q|xargs docker rm #删除所有容器</span><br><span class="line"><span class="meta">#</span><span class="bash">如果要强制删除要rm -f</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-start-amp-restart-amp-kill-amp-stop"><a href="#docker-start-amp-restart-amp-kill-amp-stop" class="headerlink" title="docker start &amp; restart &amp; kill &amp; stop"></a>docker start &amp; restart &amp; kill &amp; stop</h5><ul>
<li>启动和停止操作<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start    容器ID</span><br><span class="line">docker restart  容器ID</span><br><span class="line">docker kill     容器ID</span><br><span class="line">docker stop     容器ID</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-stats"><a href="#docker-stats" class="headerlink" title="docker stats"></a>docker stats</h5><ul>
<li><p>统计容器中的程序占用率</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker stats [dockerId]</span></span><br><span class="line">[akachi@AKACHI-PC-2018-wsl dell]$ docker stats 9d1b7b6f042469df8f229d3b565483bd2319061de268b8f980fda5a9c71fa369</span><br><span class="line">CONTAINER ID   NAME                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O   PIDS</span><br><span class="line">9d1b7b6f0424   elasticearch_test   0.74%     3.366GiB / 24.95GiB   13.49%    766B / 0B   0B / 0B     46</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-export"><a href="#docker-export" class="headerlink" title="docker export"></a>docker export</h5><p>导出容器成为一个容器文件</p>
<p>相当于虚拟机快照</p>
<p>但是这个操作会与docker save不同，他会丢失掉历史数据。</p>
<h4 id="常用的其他命令"><a href="#常用的其他命令" class="headerlink" title="常用的其他命令"></a>常用的其他命令</h4><h5 id="docker-run-1"><a href="#docker-run-1" class="headerlink" title="docker run"></a>docker run</h5><ul>
<li><p>后台启动容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令 docker run -d 镜像</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 问题docker ps 发现centos停止了</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">常见问题</span></span><br><span class="line">docker发现没有应用了，就会自动停止。</span><br><span class="line"><span class="meta">#</span><span class="bash">启动NGINX 容器后发现自己没有内容在运行就直接停止了</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-logs"><a href="#docker-logs" class="headerlink" title="docker logs"></a>docker logs</h5><ul>
<li><p>查看日志命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker logs --<span class="built_in">help</span></span></span><br><span class="line"></span><br><span class="line">Usage:  docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">Fetch the logs of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow log output</span><br><span class="line">      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m for 42 minutes)</span><br><span class="line">  -n, --tail string    Number of lines to show from the end of the logs (default &quot;all&quot;)</span><br><span class="line">  -t, --timestamps     Show timestamps</span><br><span class="line">  </span><br><span class="line"><span class="meta">  #</span><span class="bash">运行一个有工作的linux</span></span><br><span class="line">  docker run -d centos /bin/bash -c &quot;while true;do echo akachi;sleep 1;done&quot;</span><br><span class="line"><span class="meta">  #</span><span class="bash">查看日志</span></span><br><span class="line">  docker logs -ft --tail 10 55e74d0ad3ad</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-top"><a href="#docker-top" class="headerlink" title="docker top"></a>docker top</h5><ul>
<li><p>查看系统内的进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker top 55e74d0ad3ad</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                735                 715                 0                   00:07               ?                   00:00:00            /bin/bash -c while true;do echo akachi;sleep 1;done</span><br><span class="line">root                2327                735                 0                   00:14               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-inspect"><a href="#docker-inspect" class="headerlink" title="docker inspect"></a>docker inspect</h5><ul>
<li><p>查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker inspect --<span class="built_in">help</span></span></span><br><span class="line">  -f, --format string   Format the output using the given Go template</span><br><span class="line">  -s, --size            Display total file sizes if the type is container</span><br><span class="line">      --type string     Return JSON for specified type</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">例子</span></span><br><span class="line">docker inspect 55e74d0ad3ad</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;55e74d0ad3aded452ce53a564a62654e2da81e4ace24e8b349c7e341c65a3e8f&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-15T16:07:48.143683187Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo akachi;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 735,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-04-15T16:07:48.528694485Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/55e74d0ad3aded452ce53a564a62654e2da81e4ace24e8b349c7e341c65a3e8f/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/55e74d0ad3aded452ce53a564a62654e2da81e4ace24e8b349c7e341c65a3e8f/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/55e74d0ad3aded452ce53a564a62654e2da81e4ace24e8b349c7e341c65a3e8f/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/55e74d0ad3aded452ce53a564a62654e2da81e4ace24e8b349c7e341c65a3e8f/55e74d0ad3aded452ce53a564a62654e2da81e4ace24e8b349c7e341c65a3e8f-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/youthful_payne&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/86c7812852ca518c6e817da6d5172d601c202919c98a4ecd3c138ae3d5d1fec9-init/diff:/var/lib/docker/overlay2/c1ed3c290e00393e38bd627a5d46775616d83e3ee7168372ea4858497f4e09f5/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/86c7812852ca518c6e817da6d5172d601c202919c98a4ecd3c138ae3d5d1fec9/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/86c7812852ca518c6e817da6d5172d601c202919c98a4ecd3c138ae3d5d1fec9/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/86c7812852ca518c6e817da6d5172d601c202919c98a4ecd3c138ae3d5d1fec9/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;55e74d0ad3ad&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo akachi;sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;82fa2f4ee45534cbcd77652e6b25199b5bbfd5c3f4c4658f8ca83d1f30615021&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/82fa2f4ee455&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;43d8c4ef3e9040fa1fa63811781d5296425e1337519a8e53f6e7393aacf44bb5&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;594bdad93d28de604c79b8139ce4a5f610b3fd8b3d624fd744def8838b996f36&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;43d8c4ef3e9040fa1fa63811781d5296425e1337519a8e53f6e7393aacf44bb5&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-exec-amp-docker-attach"><a href="#docker-exec-amp-docker-attach" class="headerlink" title="docker exec &amp; docker attach"></a>docker exec &amp; docker attach</h5><ul>
<li><p>进入容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker <span class="built_in">exec</span> -it 容器id bashShell</span></span><br><span class="line"><span class="meta">#</span><span class="bash">开启行的 terminal</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">Options:</span></span><br><span class="line">  -d, --detach               Detached mode: run command in the background</span><br><span class="line">      --detach-keys string   Override the key sequence for detaching a container</span><br><span class="line">  -e, --env list             Set environment variables</span><br><span class="line">      --env-file list        Read in a file of environment variables</span><br><span class="line">  -i, --interactive          Keep STDIN open even if not attached</span><br><span class="line">      --privileged           Give extended privileges to the command</span><br><span class="line">  -t, --tty                  Allocate a pseudo-TTY</span><br><span class="line">  -u, --user string          Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</span><br><span class="line">  -w, --workdir string       Working directory inside the container</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash">docker attach 容器ID</span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入当前正在运行的terminal</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-cp"><a href="#docker-cp" class="headerlink" title="docker cp"></a>docker cp</h5><ul>
<li><p>主机拷贝数据到容器内</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker cp 容器ID 路径 主机路径</span></span><br><span class="line"> docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</span><br><span class="line"><span class="meta">#</span><span class="bash">未来使用数据卷技术联通</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="docker-login"><a href="#docker-login" class="headerlink" title="docker login"></a>docker login</h5><p>登陆 hub docker命令</p>
<h6 id="问题列表"><a href="#问题列表" class="headerlink" title="问题列表"></a>问题列表</h6><ul>
<li><p>无法使用http get 请求</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改文件daemon.json</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	&quot;insecure-registries&quot;: [&quot;192.168.2.129:5000&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="打包命令"><a href="#打包命令" class="headerlink" title="打包命令"></a>打包命令</h4><h5 id="docker-commit"><a href="#docker-commit" class="headerlink" title="docker commit"></a>docker commit</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker commit -m <span class="string">&quot;message&quot;</span> -a <span class="string">&quot;author&quot;</span> 容器ID 目标镜像名:[TAG]</span>  </span><br></pre></td></tr></table></figure>

<p><strong>创造一个自己的tomcat</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker commit -a=<span class="string">&quot;akachi&quot;</span> -m=<span class="string">&quot;add webapps and remove at webapps.dist&quot;</span> 4fe4a0777a29 tomcat_akachi:1.0</span></span><br><span class="line">  -a, --author string    Author (e.g., &quot;John Hannibal Smith &lt;hannibal@a-team.com&gt;&quot;)</span><br><span class="line">  -m, --message string   Commit message</span><br><span class="line">  -c, --change list      Apply Dockerfile instruction to the created image</span><br><span class="line">  -p, --pause            Pause container during commit (default true)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="dockers-build"><a href="#dockers-build" class="headerlink" title="dockers build"></a>dockers build</h5><ol>
<li><p>地址 hub.docker.com</p>
</li>
<li><p>使用 dockers login 登陆</p>
</li>
<li><p>在服务器上提交镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Log in to a Docker registry or cloud backend.</span><br><span class="line">If no registry server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  docker login [OPTIONS] [SERVER] [flags]</span><br><span class="line">  docker login [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  azure       Log in to azure</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -h, --help              Help for login</span><br><span class="line">  -p, --password string   password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   username</span><br><span class="line"></span><br><span class="line">Use &quot;docker login [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure></li>
<li><p>登陆后提交 镜像使用 docker push</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">注意在使用docker push 时push的镜像必须是 [本用户名]/imagename[tag]</span></span><br><span class="line">docker push akachi/mytomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/akachi/mytomcat]</span><br><span class="line">44793e2a4b5c: Pushed</span><br><span class="line">7ccebed91949: Pushed</span><br><span class="line">5f70bf18a086: Pushed</span><br><span class="line">2653d992f4ef: Pushed</span><br><span class="line">1.0: digest: sha256:e7b4e3a3536c69ba9cebbef5cd3f73c4a8d68eecb4fd21a75e0dd6339aedfbf6 size: 1160</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="docker-network-inspect"><a href="#docker-network-inspect" class="headerlink" title="docker network inspect"></a>docker network inspect</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">4c060768ae23   bridge    bridge    local</span><br><span class="line">920827256eba   host      host      local</span><br><span class="line">30723751be30   none      null      local</span><br><span class="line">2a2f74e8b124   thenet    bridge    local</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network inspect thenet</span><br><span class="line"><span class="meta">#</span><span class="bash">查看docker具体的网络情况</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker inspect </span><br></pre></td></tr></table></figure>

<h5 id="docker-network-create"><a href="#docker-network-create" class="headerlink" title="docker network create"></a>docker network create</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建docker网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network create --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network create [OPTIONS] NETWORK</span><br><span class="line"></span><br><span class="line">Create a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --attachable           Enable manual container attachment</span><br><span class="line">      --aux-address map      Auxiliary IPv4 or IPv6 addresses used by Network driver (default map[])</span><br><span class="line">      --config-from string   The network from which to copy the configuration</span><br><span class="line">      --config-only          Create a configuration only network</span><br><span class="line">  -d, --driver string        Driver to manage the Network (default &quot;bridge&quot;)</span><br><span class="line">      --gateway strings      IPv4 or IPv6 Gateway for the master subnet</span><br><span class="line">      --ingress              Create swarm routing-mesh network</span><br><span class="line">      --internal             Restrict external access to the network</span><br><span class="line">      --ip-range strings     Allocate container ip from a sub-range</span><br><span class="line">      --ipam-driver string   IP Address Management Driver (default &quot;default&quot;)</span><br><span class="line">      --ipam-opt map         Set IPAM driver specific options (default map[])</span><br><span class="line">      --ipv6                 Enable IPv6 networking</span><br><span class="line">      --label list           Set metadata on a network</span><br><span class="line">  -o, --opt map              Set driver specific options (default map[])</span><br><span class="line">      --scope string         Control the network&#x27;s scope</span><br><span class="line">      --subnet strings       Subnet in CIDR format that represents a network segment</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$</span><br><span class="line"><span class="meta">#</span><span class="bash"> 例子创建一个thenet</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network create --driver bridge --subnet 192.114.2.0/24 --gateway 192.114.2.200 thenet</span><br><span class="line">195dd09926a8b48d224441aef769a55f8fff6c55dbf2578619e0a5ae7c562693</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network inspect thenet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;thenet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;195dd09926a8b48d224441aef769a55f8fff6c55dbf2578619e0a5ae7c562693&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-06-19T08:44:53.7318806Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.114.2.0/24&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.114.2.200&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="docker-network-remove-thenet"><a href="#docker-network-remove-thenet" class="headerlink" title="docker network remove thenet"></a>docker network remove thenet</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">移除网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network remove thenet</span><br><span class="line">thenet</span><br></pre></td></tr></table></figure>

<p>打包命令</p>
<h5 id="docker-network-connect"><a href="#docker-network-connect" class="headerlink" title="docker network connect"></a>docker network connect</h5><p>connect命令的功能是连接一个容器到一个网络</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network connect --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">Connect a container to a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --alias strings           Add network-scoped alias for the container</span><br><span class="line">      --driver-opt strings      driver options for the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --link list               Add link to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address for the container</span><br><span class="line">      </span><br><span class="line"><span class="meta">#</span><span class="bash">使用方式参考文档</span></span><br><span class="line">docker network connect [参数] 网络名称 容器名或ID</span><br></pre></td></tr></table></figure>



<h4 id="查看docker仓库"><a href="#查看docker仓库" class="headerlink" title="查看docker仓库"></a>查看docker仓库</h4><p>curl -XGET <a target="_blank" rel="noopener" href="http://192.168.2.129:5000/v2/_catalog">http://192.168.2.129:5000/v2/_catalog</a></p>
<h4 id="命令备注"><a href="#命令备注" class="headerlink" title="命令备注"></a>命令备注</h4><p>​    在 官网的 reference(查询) docker cli(docker客户端下有所有命令)</p>
<h5 id="docker命令图"><a href="#docker命令图" class="headerlink" title="docker命令图"></a>docker命令图</h5><p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/20210614215658.png" alt="image-20210609154440482"></p>
<h3 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h3><h4 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h4><p>吧数据放到容器外面，持久化数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /home/test:/home centos /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试下来这种情况不能从外部修改数据</span></span><br></pre></td></tr></table></figure>

<ul>
<li>操作MySQL容器挂载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 运行一个docker</span></span><br><span class="line">docker run -d -p 3316:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name Test_V_MySQL mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有的卷</span></span><br><span class="line">docker volume ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看卷具体位置</span></span><br><span class="line">docker volume inspect [name]</span><br></pre></td></tr></table></figure>

<h4 id="具名挂载"><a href="#具名挂载" class="headerlink" title="具名挂载"></a>具名挂载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">指定外部挂载</span></span><br><span class="line">docker run -d -P --name negix02 -v juming-ngix:/etc/nginx nginx</span><br></pre></td></tr></table></figure>



<h4 id="匿名挂载"><a href="#匿名挂载" class="headerlink" title="匿名挂载"></a>匿名挂载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 不指定外部挂载</span></span><br><span class="line">docker run -d -P --name negix02 -v /etc/nginx nginx</span><br></pre></td></tr></table></figure>

<h4 id="概况"><a href="#概况" class="headerlink" title="概况"></a>概况</h4><ul>
<li>具名挂载 -v 容器内路径</li>
<li>匿名挂载 -v 卷名:容器名</li>
<li>指定路径挂载 -v /宿主机路径:/容器内路径</li>
</ul>
<h4 id="特殊情况"><a href="#特殊情况" class="headerlink" title="特殊情况"></a>特殊情况</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 改变读写权限</span></span><br><span class="line">RO 只读</span><br><span class="line">RW 可读写</span><br><span class="line">docker run -d -p --name negix03 -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -p --name negix03 -v juming-nginx:/etc/nginx:rw nginx</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> RO指容器无法从内部改变</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> RW指容器有读写权限</span></span><br></pre></td></tr></table></figure>

<h4 id="多MySQL同步数据"><a href="#多MySQL同步数据" class="headerlink" title="多MySQL同步数据"></a>多MySQL同步数据</h4><p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/06/21/114739.png" alt="image-20210608172454714"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run -it --name docker01 akachi/centos</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker run -it --name docker02 --volumes-from docker01 akachi/centos</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker run -it --name docker03 --volumes-from docker01 akachi/centos</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在以上情况下实际上是docker 02 与03 都挂载卷到了宿主机的相同目录下</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试MySQL</span></span><br><span class="line">docker run -d -p 3316:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动mysql2</span></span><br><span class="line">docker run -d -p 3326:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from  mysql01 mysql:5.7</span><br></pre></td></tr></table></figure>

<h3 id="docker-网络"><a href="#docker-网络" class="headerlink" title="docker 网络"></a>docker 网络</h3><p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/20210615234938.png" alt="image-20210615234938506"></p>
<p><strong>使用docker网络使不同容器中的对象能够互相调用，比如tomcat调用mysql</strong></p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/20210615235125.png" alt="image-20210615235125452"></p>
<blockquote>
<p>查看tomcat所在地址</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动tomcat</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line">Status: Downloaded newer image for tomcat:latest</span><br><span class="line"><span class="meta">#</span><span class="bash">查看tomcat本机地址</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: sit0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/sit 0.0.0.0 brd 0.0.0.0</span><br><span class="line">9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$</span><br><span class="line"><span class="meta">#</span><span class="bash"> 系统分配了一个eth0@if10地址给这个dockers服务器</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>每启动一个dockers都会多出一对网卡</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/20210616001554.png" alt="image-20210616001554868"></p>
<blockquote>
<p>原理</p>
</blockquote>
<ol>
<li>每启动一个dockers容器docker就会为它分配一个IP地址</li>
<li>只要安装了dockers就会启动一个docker0</li>
<li>docker0网卡默认使用桥接模式。</li>
<li>docker0使用的是evth-pair技术！</li>
</ol>
<blockquote>
<p>什么是evth-pair 技术！</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">evth-pair 技术就是一堆虚拟设备接口</span></span><br><span class="line"><span class="meta">#</span><span class="bash">他们是成对出现的连接着协议。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Bridge OVS都是基于evth-pair的</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>网络模型图</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/20210616003446.png" alt="image-20210616003446277"></p>
<p>大概率是以上情况，使用的是evth-pair技术的 Bridge(桥接模式)进行连接，Linuxbriged 充当一个路由器。</p>
<p>在桥接的情况下，LinuxBridge要么使用广播要么使用路由表的形式去转发请求</p>
</blockquote>
<blockquote>
<p>思考: 能不能再docker环境中使用dns服务</p>
</blockquote>
<h4 id="连接网络link"><a href="#连接网络link" class="headerlink" title="连接网络link"></a>连接网络link</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker run -d -P --name tomcat03 --link tomcat01 tomcat</span><br><span class="line">09e36e36926cb49f546f33558803e09f9928d3e83a2cef4abbdbf2960b970e38</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ doc^C</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ dc^C</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker exec tomcat03 ping tomcat01</span><br><span class="line">PING tomcat01 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01 (172.17.0.3): icmp_seq=1 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from tomcat01 (172.17.0.3): icmp_seq=2 ttl=64 time=0.028 ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>会有很多坑，在–link的情况下  </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">通过network命令查看docker网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">511e6530ee56   bridge    bridge    local</span><br><span class="line">920827256eba   host      host      local</span><br><span class="line">30723751be30   none      null      local</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network inspect 511e6530ee56</span><br><span class="line"><span class="meta">#</span><span class="bash">通过以上命令我们可以看到所有网络</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看dockers容器冲在哪里显示了links的信息</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">通过dockers inspect tomcat03</span></span><br><span class="line"><span class="meta">#</span><span class="bash">可以看到一个Links :[]</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/20210616012504.png" alt="image-20210616012504737"></p>
<blockquote>
<p>实现原理</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">实际上是通过hosts来实现的连接</span></span><br><span class="line">root@09e36e36926c:/etc# cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.17.0.3      tomcat01 627b81dd0837</span><br><span class="line">172.17.0.4      09e36e36926c</span><br></pre></td></tr></table></figure>



<blockquote>
<p>现在不用–link了</p>
</blockquote>
<h4 id="dockers网络原理"><a href="#dockers网络原理" class="headerlink" title="dockers网络原理"></a>dockers网络原理</h4><blockquote>
<p>最新的情况下我们以及不建议用docker0 来作为docker的网络了</p>
<p>正真的容器互联技术:</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看所有docker网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 ~]$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">511e6530ee56   bridge    bridge    local</span><br><span class="line">920827256eba   host      host      local</span><br><span class="line">30723751be30   none      null      local</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>网络有几种模式？</p>
</blockquote>
<ul>
<li><p>bridge: 桥接(默认)</p>
</li>
<li><p>none:不配置网络</p>
</li>
<li><p>host: 主机模式</p>
</li>
<li><p>container:容器内网络联通(用的少)</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat11 --net bridge tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash">通过这个方式启动的tomcat与默认的情况下启动是等价的，只是显示指定了bridge</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建一个子网</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> driver bridge</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -subnet 192.114.2.0/24</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --gateway 192.114.2.200</span></span><br><span class="line">[root@localhost ~]#  docker network create --driver bridge --subnet 192.114.2.0/24 --gateway 192.114.2.200 thenet</span><br><span class="line">3a6644ad4aaa6b236a42149ed9212b7dcd9ad1fda4a2309ac4ae664d0cedc7b9</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">594bdad93d28   bridge    bridge    local</span><br><span class="line">1578412b80fd   host      host      local</span><br><span class="line">653c0a1495dd   none      null      local</span><br><span class="line">3a6644ad4aaa   thenet    bridge    local</span><br><span class="line"><span class="meta">#</span><span class="bash"> 现在ip addr中多了一条数据</span></span><br><span class="line">[root@localhost ~]# ip addr</span><br><span class="line">102: br-3a6644ad4aaa: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    link/ether 02:42:10:d3:1b:22 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.114.2.200/24 brd 192.114.2.255 scope global br-3a6644ad4aaa</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta">#</span><span class="bash"> 看到了自己的网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network inspect thenet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;thenet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;195dd09926a8b48d224441aef769a55f8fff6c55dbf2578619e0a5ae7c562693&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-06-19T08:44:53.7318806Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.114.2.0/24&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.114.2.200&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="测试一个自己的tomcat"><a href="#测试一个自己的tomcat" class="headerlink" title="测试一个自己的tomcat"></a>测试一个自己的tomcat</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">在新的网络thenet中创建两个tomcat</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker run -d -P --name tomcat-thenet01 --net thenet tomcat</span><br><span class="line">96a4ccf5a2504e4539e11e825e065129aaa1c88483c41b6b84ad3544ccb9f3ed</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker run -d -P --name tomcat-thenet02 --net thenet tomcat</span><br><span class="line">a75d75b18d1532e6b89d4e81eeae685534a9d3f2c287e50cea4b2277e57bd0ce</span><br><span class="line"><span class="meta">#</span><span class="bash">查看新的网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network inspect thenet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;thenet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;195dd09926a8b48d224441aef769a55f8fff6c55dbf2578619e0a5ae7c562693&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-06-19T08:44:53.7318806Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.114.2.0/24&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.114.2.200&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;96a4ccf5a2504e4539e11e825e065129aaa1c88483c41b6b84ad3544ccb9f3ed&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-thenet01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;09d10adc87108b9bb7b26b95bcd64b92ee3c7af3c578f667867f64a16da198fc&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:72:02:01&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.114.2.1/24&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;a75d75b18d1532e6b89d4e81eeae685534a9d3f2c287e50cea4b2277e57bd0ce&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-thenet02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;d82e07548a9b9990fc31e82d9e47d10c0e691bde6aa38c470772e792982fbd67&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:72:02:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.114.2.2/24&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta">#</span><span class="bash">我们发现多了两个节点分别是2.1和2.2</span></span><br><span class="line"><span class="meta">#</span><span class="bash">我们再进入其中一台ping另外一台</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker exec -it tomcat-thenet02 /bin/bash</span><br><span class="line">root@a75d75b18d15:/usr/local/tomcat# ping tomcat-thenet01</span><br><span class="line">PING tomcat-thenet01 (192.114.2.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-thenet01.thenet (192.114.2.1): icmp_seq=1 ttl=64 time=0.087 ms</span><br><span class="line">64 bytes from tomcat-thenet01.thenet (192.114.2.1): icmp_seq=2 ttl=64 time=0.032 ms</span><br><span class="line"><span class="meta">#</span><span class="bash">真神奇这个网络中的对象直接可以相互ping通</span></span><br><span class="line"><span class="meta">#</span><span class="bash">自定义的桥接修复了docker0的问题</span></span><br></pre></td></tr></table></figure>

<h4 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h4><p>我们已经知道在新建的桥接之上的容器是可以相互连通的。</p>
<p>现在要联通不同网络之间的操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建一个tomcat</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line">58f4ddd56c9c3e02033817b411b4650758cd855e25ee2056d1cf0ce03e43f5f4</span><br><span class="line"><span class="meta">#</span><span class="bash">查看命令</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network connect --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">Connect a container to a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --alias strings           Add network-scoped alias for the container</span><br><span class="line">      --driver-opt strings      driver options for the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --link list               Add link to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address for the container</span><br><span class="line">      </span><br><span class="line"><span class="meta">#</span><span class="bash">我们得知查看是通过先网络名后容器命来调用连接的</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network connect thenet tomcat01</span><br><span class="line"><span class="meta">#</span><span class="bash">调用连接tomcat01 连接到thenet上</span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看容器网络</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker inspect tomcat01</span><br><span class="line">  &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;7b530392865cc2f1dc9ec6c3aeacc68193959bead9b0e841acb8230f080094fa&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;f2e7077db1ef912bbad2a1633f238702b85e079d8d221614aeb3415e5b86cb61&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;thenet&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: &#123;&#125;,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: [</span><br><span class="line">                        &quot;58f4ddd56c9c&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;195dd09926a8b48d224441aef769a55f8fff6c55dbf2578619e0a5ae7c562693&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;dd68289ac0e60f31eef960173709271c8f8f69a0d5964f1415a47edbdb1c1d65&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.114.2.200&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;192.114.2.3&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 24,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:c0:72:02:03&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: &#123;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">           &#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">我们查看网络得知这个tomcat01已经拥有两个网络并且IP风别显示出来了</span></span><br><span class="line"><span class="meta">#</span><span class="bash">测试双向是否能ping同双向IP是否能ping通</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                                                  NAMES</span><br><span class="line">58f4ddd56c9c   tomcat         &quot;catalina.sh run&quot;        6 minutes ago    Up 6 minutes    0.0.0.0:49155-&gt;8080/tcp, :::49155-&gt;8080/tcp            tomcat01</span><br><span class="line">a75d75b18d15   tomcat         &quot;catalina.sh run&quot;        22 minutes ago   Up 22 minutes   0.0.0.0:49154-&gt;8080/tcp, :::49154-&gt;8080/tcp            tomcat-thenet02</span><br><span class="line">96a4ccf5a250   tomcat         &quot;catalina.sh run&quot;        22 minutes ago   Up 22 minutes   0.0.0.0:49153-&gt;8080/tcp, :::49153-&gt;8080/tcp            tomcat-thenet01</span><br><span class="line">c191a5546e2b   mysql:8.0.25   &quot;docker-entrypoint.s…&quot;   4 weeks ago      Up 3 hours      0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mysql_test</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker exec -it tomcat01 ping tomcat-thenet02</span><br><span class="line">PING tomcat-thenet02 (192.114.2.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-thenet02.thenet (192.114.2.2): icmp_seq=1 ttl=64 time=0.099 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-thenet02 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 0.099/0.099/0.099/0.000 ms</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker exec -it tomcat-thenet02 ping tomcat01</span><br><span class="line">PING tomcat01 (192.114.2.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01.thenet (192.114.2.3): icmp_seq=1 ttl=64 time=0.032 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat01 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 0.032/0.032/0.032/0.000 ms</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker exec -it tomcat-thenet02 ping 192.114.2.3</span><br><span class="line">PING 192.114.2.3 (192.114.2.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.114.2.3: icmp_seq=1 ttl=64 time=0.040 ms</span><br><span class="line">64 bytes from 192.114.2.3: icmp_seq=2 ttl=64 time=0.051 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.114.2.3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 73ms</span><br><span class="line">rtt min/avg/max/mdev = 0.040/0.045/0.051/0.008 ms</span><br><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker exec -it tomcat01 ping 192.168.2.2</span><br><span class="line">PING 192.168.2.2 (192.168.2.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.2.2: icmp_seq=1 ttl=37 time=5.10 ms</span><br><span class="line">64 bytes from 192.168.2.2: icmp_seq=2 ttl=37 time=5.49 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.2.2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 5.095/5.290/5.486/0.208 ms</span><br><span class="line"><span class="meta">#</span><span class="bash">我们先查看了所有容器</span></span><br><span class="line"><span class="meta">#</span><span class="bash">先在tomcat01中用容器名ping tomcat-thenet02</span></span><br><span class="line"><span class="meta">#</span><span class="bash">再用tomcat-thenet02中用容器名ping tomcat01</span></span><br><span class="line"><span class="meta">#</span><span class="bash">再试ip结果都是通的</span></span><br><span class="line"><span class="meta">#</span><span class="bash">当然ping tomcat01的另一个网络docker0 中的IP必然是不通的这里就不试了</span></span><br></pre></td></tr></table></figure>



<h3 id="dockerFile"><a href="#dockerFile" class="headerlink" title="dockerFile"></a>dockerFile</h3><h4 id="初步认识dockerFile"><a href="#初步认识dockerFile" class="headerlink" title="初步认识dockerFile"></a>初步认识dockerFile</h4><p>Dockerfile是官方命名创建Dockerfile文件时使请使用这个</p>
<p>dockerFile就是构建docker镜像的文件。是一段命令脚本，通过脚本可以生成镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个dockerfile1 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内容如下</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> build一个docker image</span></span><br><span class="line">docker build -f dockerfile1 -t akachi/centos:1.0 .</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">docker run -it akachi/centos:1.0 /bin/bash</span><br></pre></td></tr></table></figure>

<h5 id="dockerFile-构建步骤"><a href="#dockerFile-构建步骤" class="headerlink" title="dockerFile 构建步骤"></a>dockerFile 构建步骤</h5><ol>
<li>编写一个dockerfile文件</li>
<li>构建一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push 发布镜像 DockerHub</li>
</ol>
<h5 id="DockerFile-命令"><a href="#DockerFile-命令" class="headerlink" title="DockerFile 命令"></a>DockerFile 命令</h5><ul>
<li><p>官方地址</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">https://docs.docker.com/develop/develop-images/dockerfile_best-practices/</a></p>
</li>
<li><p>常用命令</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/06/21/114658.png" alt="image-20210610135844359"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM		#镜像基于谁</span><br><span class="line">MAINTAINER	#作者 akachi&lt;zsts@hotmail.com&gt;</span><br><span class="line">RUN			#谁构建</span><br><span class="line">CMD			#操作 指定这个容器启动的时候要运行的命令,只有最后一个会生效，可被替代</span><br><span class="line">ADD			#添加内容如压缩包 会自动解压</span><br><span class="line">WORKDIR		#镜像的工作目录</span><br><span class="line">VOLUME		#容器卷</span><br><span class="line">EXPOSE		#暴露端口</span><br><span class="line">ENTRYPOINT	#操作 指定这个容器启动的时候要运行的命令。</span><br><span class="line">ONBUILD		#当构建一个被继承的DockerFile这个时候会运行一个ONBUILD的指令。</span><br><span class="line">COPY		#类似ADDD，将我们的文件拷贝到镜像中</span><br><span class="line">ENV			#构建的时候设置环境变量 -e</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建一个自己的centOS</p>
<p>:可以抄袭hub.docker.com</p>
</blockquote>
<p>数据</p>
</li>
<li><p>地方</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/06/21/114702.png" alt="image-20210609154447560"></p>
<h5 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h5><ul>
<li>每一个保留的关键字都是大写</li>
<li>执行从上到下</li>
<li>#表示注释</li>
<li>每一个指令都会创建并提交一个新的镜像层。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/06/21/114705.png" alt="image-20210609154807565"></p>
<p>dockerfile是面向开发的，我没交付项目都是用docker的。</p>
<p>步骤：上线、部署、运维</p>
<p>DockerFile：定义了步骤</p>
<p>DockerImages:通过dockerFile构建生成镜像</p>
<p>Docker容器：容器就是运行的镜像</p>
<h5 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建  mydockerfile-centos文件</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER akachi&lt;zsts@hotmail.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 8084</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">执行docker build</span></span><br><span class="line">docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">在这个练习中我们加入了config命令，设定了用户工作路径为MYPATH并且创建了一个docker images</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>CMD和 ENTRYPOINT的区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD			#操作 指定这个容器启动的时候要运行的命令,只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT	#操作 指定这个容器启动的时候要运行的命令。</span><br></pre></td></tr></table></figure>

<h6 id="测试CMD"><a href="#测试CMD" class="headerlink" title="测试CMD"></a>测试CMD</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建<span class="built_in">test</span></span></span><br><span class="line">FROM centos</span><br><span class="line">CMD /bin/bash</span><br><span class="line">CMD ls -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行起来可以</span></span><br></pre></td></tr></table></figure>

<h6 id="测试ENTRYPOINT"><a href="#测试ENTRYPOINT" class="headerlink" title="测试ENTRYPOINT"></a>测试ENTRYPOINT</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在这种情况下 可以追加-l命令</span></span><br><span class="line">[akachi@AKACHI-PC-2018 dockerfile]$ docker run -it test:3 -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jun 11 09:28 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jun 11 09:28 ..</span><br></pre></td></tr></table></figure>

<h4 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h4><ol>
<li><p>地址 hub.docker.com</p>
</li>
<li><p>在服务器上提交镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login [command] --help</span><br></pre></td></tr></table></figure></li>
<li><p>登陆后提交 镜像使用 docker push</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">注意在使用docker push 时push的镜像必须是 [仓库名]:imagename[tag]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">dockerhub 的push的镜像必须是 [本用户名]/[仓库名]/imagename[tag]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">例子 192.168.2.129:5000/clairvoyance/listener:1.0</span></span><br><span class="line">docker push akachi/mytomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/akachi/mytomcat]</span><br><span class="line">44793e2a4b5c: Pushed</span><br><span class="line">7ccebed91949: Pushed</span><br><span class="line">5f70bf18a086: Pushed</span><br><span class="line">2653d992f4ef: Pushed</span><br><span class="line">1.0: digest: sha256:e7b4e3a3536c69ba9cebbef5cd3f73c4a8d68eecb4fd21a75e0dd6339aedfbf6 size: 1160</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="常用的镜像名"><a href="#常用的镜像名" class="headerlink" title="常用的镜像名"></a>常用的镜像名</h4><ul>
<li>java:<ul>
<li>openjdk:8-jre-slim</li>
<li>openjdk:11-jre-slim</li>
</ul>
</li>
<li></li>
</ul>
<h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><p>操作dockersComposeke以操作多个dockers文件</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/06/24/144544.png" alt="image-20210624144530010"></p>
<p>官方文档:</p>
<p>dockerCommpose是一个定义多个容器的，</p>
<p>可以通过YAML进行配置的工具。</p>
<p>single command 看看有多少命令</p>
<ol>
<li>我们要有一个Dockerfile</li>
<li>我们要写一个docker-compose.yml</li>
<li>运行 docker compose up </li>
</ol>
<p><strong>dockercompose的作用是:批量容器编排</strong></p>
<blockquote>
<p>理解 </p>
<p>compose是docker官方的开源项项目 需要独立安装</p>
</blockquote>
<p><code>docker-compose.yml</code> looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.9&quot;  # optional since v1.27.0</span><br><span class="line">services:</span><br><span class="line">  web: #Web服务</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - .:/code</span><br><span class="line">      - logvolume01:/var/log</span><br><span class="line">    links:</span><br><span class="line">      - redis #依赖</span><br><span class="line">  redis: #redis 服务</span><br><span class="line">    image: redis</span><br><span class="line">volumes:</span><br><span class="line">  logvolume01: &#123;&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>概念</p>
<p>services= 容器</p>
<p>project = 项目 一组关联的容器</p>
<p>volumes:挂载 </p>
</blockquote>
<h4 id="linux安装docker-compose"><a href="#linux安装docker-compose" class="headerlink" title="linux安装docker compose"></a>linux安装docker compose</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">查看系统</span><br><span class="line"></span><br><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">#</span><span class="bash"> 阿里路径</span></span><br><span class="line">sudo curl -L &quot;https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>



<h4 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h4><p>[官方体验步骤] docs.docker.com/compose/gettingstarted/</p>
<p>1、编写应用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">import redis</span><br><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=&#x27;redis&#x27;, port=6379)</span><br><span class="line"></span><br><span class="line">def get_hit_count():</span><br><span class="line">    retries = 5</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            return cache.incr(&#x27;hits&#x27;)</span><br><span class="line">        except redis.exceptions.ConnectionError as exc:</span><br><span class="line">            if retries == 0:</span><br><span class="line">                raise exc</span><br><span class="line">            retries -= 1</span><br><span class="line">            time.sleep(0.5)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def hello():</span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    return &#x27;Hello World! I have been seen &#123;&#125; times.\n&#x27;.format(count)</span><br></pre></td></tr></table></figure>

<p>2、载入依赖程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">redis</span><br></pre></td></tr></table></figure>

<p>3、编写dockerfile文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER akachi&lt;zsts@hotmail.com&gt;</span><br><span class="line"></span><br><span class="line">ENV yum -y install vim</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">ENV REDIS_NAME=redis</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ADD addfile/jdk-15_linux-x64_bin.tar.gz $MYPATH</span><br><span class="line"></span><br><span class="line">ADD *.jar $MYPATH/app.jar</span><br><span class="line"><span class="meta">#</span><span class="bash">ADD addfile/apache-tomcat-10.0.6.tar.gz <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME $MYPATH/jdk-15</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"><span class="meta">#</span><span class="bash">ENV CATALINA_HOME <span class="variable">$MYPATH</span>/apache-tomcat-10.0.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ENV CATALINA_BASE <span class="variable">$CATALINA_BASE</span></span></span><br><span class="line"></span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CMD startup.sh &amp;&amp; tail -f <span class="variable">$CATALINA_HOME</span>/logs/catalina.out</span></span><br><span class="line">CMD java -jar app.jar</span><br></pre></td></tr></table></figure>

<p>4、编写docker-compose.yml文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.9&quot;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure>

<p>5、运行使用docker-compose up</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[akachi@AKACHI-PC-2018 composetest]$ docker-compose up</span><br><span class="line">Starting composetest_redis_1 ... done</span><br><span class="line">Starting composetest_web_1   ... done</span><br><span class="line">Attaching to composetest_web_1, composetest_redis_1</span><br><span class="line">redis_1  | 1:C 07 Jul 2021 08:20:20.647 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">redis_1  | 1:C 07 Jul 2021 08:20:20.648 # Redis version=6.2.4, bits=64, commit=00000000, modified=0, pid=1, just started</span><br><span class="line">redis_1  | 1:C 07 Jul 2021 08:20:20.648 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.648 * monotonic clock: POSIX clock_gettime</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.648 * Running mode=standalone, port=6379.</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.648 # Server initialized</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.648 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.648 * Loading RDB produced by version 6.2.4</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.649 * RDB age 94 seconds</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.649 * RDB memory usage when created 0.79 Mb</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.649 * DB loaded from disk: 0.000 seconds</span><br><span class="line">redis_1  | 1:M 07 Jul 2021 08:20:20.649 * Ready to accept connections</span><br><span class="line">web_1    |  * Serving Flask app &#x27;app.py&#x27; (lazy loading)</span><br><span class="line">web_1    |  * Environment: production</span><br><span class="line">web_1    |    WARNING: This is a development server. Do not use it in a production deployment.</span><br><span class="line">web_1    |    Use a production WSGI server instead.</span><br><span class="line">web_1    |  * Debug mode: off</span><br><span class="line">web_1    |  * Running on all addresses.</span><br><span class="line">web_1    |    WARNING: This is a development server. Do not use it in a production deployment.</span><br><span class="line">web_1    |  * Running on http://172.18.0.3:5000/ (Press CTRL+C to quit)</span><br><span class="line">web_1    | 172.18.0.1 - - [07/Jul/2021 08:20:25] &quot;GET / HTTP/1.1&quot; 200 -</span><br></pre></td></tr></table></figure>



<blockquote>
<p>dockercompose会做哪些事？</p>
<p>1、创建并命名进项[dirname]-[imgname]-[NUMBER]</p>
<p>​    这种设计是为了高可用性服务的</p>
<p>2、创建一个与[dirname]-default同名的网络</p>
<p>3、创建相关的镜像</p>
<p><img src="C:/Users/dell/AppData/Roaming/Typora/typora-user-images/image-20210707163348766.png" alt="image-20210707163348766"></p>
<p>4、启动的容器默认会绑定到新网络啊</p>
<p><img src="C:/Users/dell/AppData/Roaming/Typora/typora-user-images/image-20210707165140898.png" alt="image-20210707165140898"></p>
</blockquote>
<h4 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[akachi@AKACHI-PC-2018 composetest]$ docker-compose down</span><br><span class="line">Stopping composetest_web_1   ... done</span><br><span class="line">Stopping composetest_redis_1 ... done</span><br><span class="line">Removing composetest_web_1   ... done</span><br><span class="line">Removing composetest_redis_1 ... done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用docker-compose down 时会主动删除所有倍docker-compose创建的内容包括网络</span></span><br></pre></td></tr></table></figure>



<h4 id="配置解析"><a href="#配置解析" class="headerlink" title="配置解析"></a>配置解析</h4><p>docker-compose.yaml</p>
<blockquote>
<p>docker-compose中主要内容分为三块</p>
<p>1、指定版本、不同的版本对应不同的dockerengine，不能乱写在以下文档中会有明确介绍</p>
<p>2、配置服务</p>
<p>3、配置全局的内容包括network与、volumes</p>
</blockquote>
<blockquote>
<p>官方文档位置</p>
<p><img src="C:/Users/dell/AppData/Roaming/Typora/typora-user-images/image-20210707171425670.png" alt="image-20210707171425670"></p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/compose-file-v3/">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p>
<p><img src="C:/Users/dell/AppData/Roaming/Typora/typora-user-images/image-20210707171532591.png" alt="image-20210707171532591"></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 例子</span></span><br><span class="line">version: &quot;3.9&quot;# 版本 	</span><br><span class="line">services: #服务</span><br><span class="line">    redis: #服务1</span><br><span class="line">        image: redis:alpine #指定镜像</span><br><span class="line">        ports: #端口</span><br><span class="line">          - &quot;6379&quot;</span><br><span class="line">        networks: #网络</span><br><span class="line">          - frontend</span><br><span class="line">        deploy: #部署相关内容 </span><br><span class="line">          replicas: 2 #拷贝</span><br><span class="line">          update_config: #跟新内容</span><br><span class="line">            parallelism: 2 #并行</span><br><span class="line">            delay: 10s</span><br><span class="line">          restart_policy:</span><br><span class="line">            condition: on-failure</span><br><span class="line">    vote:</span><br><span class="line">        image: dockersamples/examplevotingapp_vote:before</span><br><span class="line">        ports:</span><br><span class="line">          - &quot;5000:80&quot;</span><br><span class="line">        networks:</span><br><span class="line">          - frontend</span><br><span class="line">        depends_on: #比较关键的内容 指定他们的依赖</span><br><span class="line">          - redis</span><br><span class="line">        deploy: #副本</span><br><span class="line">          replicas: 2</span><br><span class="line">          update_config:</span><br><span class="line">            parallelism: 2</span><br><span class="line">          restart_policy:</span><br><span class="line">            condition: on-failure</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="worldpress"><a href="#worldpress" class="headerlink" title="worldpress"></a>worldpress</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">https://docs.docker.com/samples/wordpress/</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">这里有一个docker-compose.yml文件</span></span><br><span class="line"></span><br><span class="line">version: &quot;3.9&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    volumes:</span><br><span class="line">      - db_data:/var/lib/mysql</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">      MYSQL_DATABASE: wordpress</span><br><span class="line">      MYSQL_USER: wordpress</span><br><span class="line">      MYSQL_PASSWORD: wordpress</span><br><span class="line"></span><br><span class="line">  wordpress:</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - wordpress_data:/var/www/html</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:80&quot;</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: db:3306</span><br><span class="line">      WORDPRESS_DB_USER: wordpress</span><br><span class="line">      WORDPRESS_DB_PASSWORD: wordpress</span><br><span class="line">      WORDPRESS_DB_NAME: wordpress</span><br><span class="line">volumes:</span><br><span class="line">  db_data: &#123;&#125;</span><br><span class="line">  wordpress_data: &#123;&#125;</span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash">使用 docker-compose up -d 可以后台运行</span></span><br></pre></td></tr></table></figure>

<h4 id="写一个spring-boot-复刻以下计数器"><a href="#写一个spring-boot-复刻以下计数器" class="headerlink" title="写一个spring boot 复刻以下计数器"></a>写一个spring boot 复刻以下计数器</h4><p><img src="C:/Users/dell/AppData/Roaming/Typora/typora-user-images/image-20210707180015756.png" alt="image-20210707180015756"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1.写好计数器项目</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2.准备文件</span></span><br><span class="line">[akachi@AKACHI-PC-2018 addfile]$ ls</span><br><span class="line">apache-tomcat-10.0.6.tar.gz  jdk-15_linux-x64_bin.tar.gz</span><br><span class="line"></span><br><span class="line">[akachi@AKACHI-PC-2018 composetest.bak]$ ls</span><br><span class="line">addfile StudyDockerCompose-0.0.1-SNAPSHOT.jar</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">3 写一个Dockerfile</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER akachi&lt;zsts@hotmail.com&gt;</span><br><span class="line"></span><br><span class="line">ENV yum -y install vim</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">ENV REDIS_NAME=redis #指定环境变量</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ADD addfile/jdk-15_linux-x64_bin.tar.gz $MYPATH</span><br><span class="line"></span><br><span class="line">ADD *.jar $MYPATH/app.jar</span><br><span class="line"><span class="meta">#</span><span class="bash">ADD addfile/apache-tomcat-10.0.6.tar.gz <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME $MYPATH/jdk-15</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"><span class="meta">#</span><span class="bash">ENV CATALINA_HOME <span class="variable">$MYPATH</span>/apache-tomcat-10.0.6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ENV CATALINA_BASE <span class="variable">$CATALINA_BASE</span></span></span><br><span class="line"></span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CMD startup.sh &amp;&amp; tail -f <span class="variable">$CATALINA_HOME</span>/logs/catalina.out</span></span><br><span class="line">CMD java -jar app.jar</span><br><span class="line"><span class="meta">#</span><span class="bash">4 写一个docker-compose.yml</span></span><br><span class="line">version: &quot;3.9&quot;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:8080&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">5 启动它</span> </span><br><span class="line">docker-compose up -d</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果使用 docker-compose up -d --build 的话会重新打包，这样可以保证在更改后仍然可以获得最新的镜像</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">6 测试</span></span><br><span class="line">[akachi@AKACHI-PC-2018 composetest.bak]$ curl http://localhost:5000/count/getAndRefurbish</span><br><span class="line">7</span><br><span class="line"><span class="meta">#</span><span class="bash">7 结束它</span></span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>



<h3 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h3><p>集群方式部署</p>
<ul>
<li>购买阿里云服务器</li>
</ul>
<h3 id="Dockers-Stack"><a href="#Dockers-Stack" class="headerlink" title="Dockers Stack"></a>Dockers Stack</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker-compose 单机部署</span><br><span class="line"></span><br><span class="line">docker stack部署,集群部署</span><br><span class="line"></span><br><span class="line">docker-compose up -d aaa.yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"></span></span><br><span class="line">docker stack deploy aaa.yaml</span><br><span class="line">[root@swarm01 ~]# docker stack --help</span><br><span class="line"></span><br><span class="line">Usage:  docker stack [OPTIONS] COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker stacks</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --orchestrator string   Orchestrator to use (swarm|kubernetes|all)</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  deploy      Deploy a new stack or update an existing stack</span><br><span class="line">  ls          List stacks</span><br><span class="line">  ps          List the tasks in the stack</span><br><span class="line">  rm          Remove one or more stacks</span><br><span class="line">  services    List the services in the stack</span><br><span class="line"></span><br><span class="line">Run &#x27;docker stack COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Docker-Secret"><a href="#Docker-Secret" class="headerlink" title="Docker Secret"></a>Docker Secret</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@swarm01 ~]# docker secret</span><br><span class="line"></span><br><span class="line">Usage:  docker secret COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker secrets</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a secret from a file or STDIN as content</span><br><span class="line">  inspect     Display detailed information on one or more secrets</span><br><span class="line">  ls          List secrets</span><br><span class="line">  rm          Remove one or more secrets</span><br><span class="line"></span><br><span class="line">Run &#x27;docker secret COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Docker-Config"><a href="#Docker-Config" class="headerlink" title="Docker  Config"></a>Docker  Config</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@swarm01 ~]# docker config</span><br><span class="line"></span><br><span class="line">Usage:  docker config COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker configs</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a config from a file or STDIN</span><br><span class="line">  inspect     Display detailed information on one or more configs</span><br><span class="line">  ls          List configs</span><br><span class="line">  rm          Remove one or more configs</span><br><span class="line"></span><br><span class="line">Run &#x27;docker config COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="可视化工具"><a href="#可视化工具" class="headerlink" title="可视化工具"></a>可视化工具</h3><h4 id="Portainer"><a href="#Portainer" class="headerlink" title="Portainer"></a>Portainer</h4><p>​    <strong>什么是Rancher ？</strong></p>
<p>​    是一个Docker的图形化管理工具</p>
<ul>
<li><p>安装代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启动命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=<span class="literal">true</span> portainer/portainer</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">参数解释</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一直重启</span></span><br><span class="line">--restart=always</span><br><span class="line"><span class="meta">#</span><span class="bash"> 挂在卷</span></span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock </span><br><span class="line"><span class="meta">#</span><span class="bash"> 给一个特殊授权 给与了内部的ROOT权限 有了这个授权我们甚至可以在docker内运行docker</span></span><br><span class="line">--privileged=true </span><br></pre></td></tr></table></figure></li>
<li><p>查看localhost:8088</p>
</li>
</ul>
<h4 id="Rancher"><a href="#Rancher" class="headerlink" title="Rancher"></a>Rancher</h4><h2 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h2><p>官方文档中使用的符号</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span><br></pre></td></tr></table></figure>



<ul>
<li><p>[] 中功能括号表示参数</p>
</li>
<li><p>:TAG表示其中一种情况 :表示知道TAG</p>
</li>
<li><p>| 代表或者的意思</p>
</li>
<li><p>@DIGEST 大概率是版本编号的意思 @有可能同:TAG 的:为了区分开其含义所以使用@</p>
</li>
<li><p>在Dockerfile的CMD中 &amp;&amp; 表示之后要执行。</p>
</li>
</ul>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><h3 id="作业1"><a href="#作业1" class="headerlink" title="作业1"></a>作业1</h3><p>docker nginx安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查询nginx</span><br><span class="line"><span class="meta">#</span><span class="bash">docker search nginx</span></span><br><span class="line">安装指定版本</span><br><span class="line"><span class="meta">#</span><span class="bash">docker pull nginx:1.19.10</span></span><br><span class="line">运行起来并指定名称和映射端口</span><br><span class="line"><span class="meta">#</span><span class="bash">docker run -d --name niginx01 -p 4454:80 nginx:1.19.10</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">whereis nginx</span></span><br><span class="line">询问系统路径</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210416140123508.png" alt="image-20210416140123508"></p>
<h3 id="作业2"><a href="#作业2" class="headerlink" title="作业2"></a>作业2</h3><p>​    安装一个Tomcat</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker run -it --rm tomcat:9.0</span></span><br><span class="line">--rm是指用完就删除</span><br><span class="line"><span class="meta">#</span><span class="bash">docker run -d -p 8031:80 tomcat:9.0 /bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">怎么在容器我提供路径</span></span><br></pre></td></tr></table></figure>



<h3 id="作业3"><a href="#作业3" class="headerlink" title="作业3"></a>作业3</h3><p>补助 ES+kibana</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ES 暴露了很多端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ES 十分消耗内存</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ES 的数据需要挂在到外部</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  docker pull elasticsearch:7.12.0</span></span><br><span class="line">7.12.0: Pulling from library/elasticsearch</span><br><span class="line">7a0437f04f83: Already exists</span><br><span class="line">2b674c951ca3: Pull complete</span><br><span class="line">06baeb69f25f: Pull complete</span><br><span class="line">eeff01d19ce5: Pull complete</span><br><span class="line">a994306398ca: Pull complete</span><br><span class="line">2c002d76c1f6: Pull complete</span><br><span class="line">6286f2196f9b: Pull complete</span><br><span class="line">Digest: sha256:383e9fb572f3ca2fdef5ba2edb0dae2c467736af96aba2c193722aa0c08ca7ec</span><br><span class="line">Status: Downloaded newer image for elasticsearch:7.12.0</span><br><span class="line">docker.io/library/elasticsearch:7.12.0</span><br><span class="line"><span class="meta">#</span><span class="bash">docker run -d --name test_elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> docker.io/library/elasticsearch:7.12.1</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">--net somenetwork? 关系到docker 网络配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash">使用 docker status 查看状态</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">由于elasticsearch 消耗资源特别高所以我们需要通过环境变量加入一个参数 限制内存的使用，这里我们直接操作java的环境变量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -e ES_JAVA_OPTS=<span class="string">&quot;-Xms64m -Xmx4g&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">dockerun --name elasticearch_test -d -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=<span class="string">&quot;-Xms3g -Xmx4g&quot;</span> elasticsearch:7.12.1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看系统占用率</span></span><br><span class="line">[akachi@AKACHI-PC-2018-wsl dell]$ docker stats 9d1b7b6f042469df8f229d3b565483bd2319061de268b8f980fda5a9c71fa369</span><br><span class="line">CONTAINER ID   NAME                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O   PIDS</span><br><span class="line">9d1b7b6f0424   elasticearch_test   0.74%     3.366GiB / 24.95GiB   13.49%    766B / 0B   0B / 0B     46</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">最后查看是否成功</span></span><br><span class="line"></span><br><span class="line">[akachi@AKACHI-PC-2018-wsl dell]$ curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;9d1b7b6f0424&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;BavyqNNXSzOoO3lEXtQSDA&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.12.1&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;3186837139b9c6b6d23c3200870651f10d3343b7&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2021-04-20T20:56:39.040728659Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.8.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="作业4"><a href="#作业4" class="headerlink" title="作业4"></a>作业4</h3><p>安装一个 Kibana 并且连接elasticsearch</p>
<ul>
<li>docker之间互相调用基本原理图</li>
</ul>
<p><img src="C:\Users\dell\AppData\Roaming\Typora\typora-user-images\image-20210505195050614.png" alt="image-20210505195050614"></p>
<h3 id="作业5-Dockerfile-tomcat"><a href="#作业5-Dockerfile-tomcat" class="headerlink" title="作业5 Dockerfile tomcat"></a>作业5 Dockerfile tomcat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建Dockerfile</span> </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER akachi&lt;zsts@hotmail.com&gt;</span><br><span class="line"></span><br><span class="line">ENV yum -y install vim</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ADD addfile/jdk-15_linux-x64_bin.tar.gz $MYPATH</span><br><span class="line">ADD addfile/apache-tomcat-10.0.6.tar.gz $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME $MYPATH/jdk-15</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME $MYPATH/apache-tomcat-10.0.6</span><br><span class="line">ENV CATALINA_BASE $CATALINA_BASE</span><br><span class="line"></span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD startup.sh &amp;&amp; tail -f $CATALINA_HOME/logs/catalina.out</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> build Dockerfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由于命名Dockerfile 在docker build的时候是不需要指定-f 的</span></span><br><span class="line">docker build -t mytomcat .</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行dockersfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定两个</span></span><br><span class="line">docker run -d -p 8080:8080 -v /home/akachi/dockerfile/webapps:/usr/local/apache-tomcat-10.0.6/webapps -v /home/akachi/dockerfile/logs:/usr/local/apache-tomcat-10.0.6/logs --name tomcat01 mytomcat</span><br></pre></td></tr></table></figure>



<h3 id="测试6-在阿里云镜像服务器中上传docker镜像"><a href="#测试6-在阿里云镜像服务器中上传docker镜像" class="headerlink" title="测试6 在阿里云镜像服务器中上传docker镜像"></a>测试6 在阿里云镜像服务器中上传docker镜像</h3><ol>
<li><p>找到阿里云的镜像服务器</p>
<p>搜索 “镜像容器服务” &gt; 点击管理控制台 &gt;点击个人或企业实例</p>
<p>或者通过URL直接进入 </p>
<p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances">https://cr.console.aliyun.com/cn-hangzhou/instances</a> &gt; 点击个人实例或企业实例</p>
</li>
<li><p>查看文档 </p>
<p>点击仓库管理&gt;镜像仓库/某个仓库，并且参考文档</p>
</li>
<li><p>文档内容</p>
<h2 id="1-登录阿里云Docker-Registry"><a href="#1-登录阿里云Docker-Registry" class="headerlink" title="1. 登录阿里云Docker Registry"></a>1. 登录阿里云Docker Registry</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker login --username=z****@hotmail.com registry.cn-hangzhou.aliyuncs.com</span><br></pre></td></tr></table></figure>

<p>用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</p>
<p>您可以在访问凭证页面修改凭证密码。</p>
<h2 id="2-从Registry中拉取镜像"><a href="#2-从Registry中拉取镜像" class="headerlink" title="2. 从Registry中拉取镜像"></a>2. 从Registry中拉取镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker pull registry.cn-hangzhou.aliyuncs.com/akachi/tomcat:[镜像版本号]</span></span><br></pre></td></tr></table></figure>

<h2 id="3-将镜像推送到Registry"><a href="#3-将镜像推送到Registry" class="headerlink" title="3. 将镜像推送到Registry"></a>3. 将镜像推送到Registry</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker login --username=z****@hotmail.com registry.cn-hangzhou.aliyuncs.com</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/akachi/tomcat:[镜像版本号]</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker push registry.cn-hangzhou.aliyuncs.com/akachi/tomcat:[镜像版本号]</span></span><br></pre></td></tr></table></figure>

<p>请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。</p>
<h2 id="4-选择合适的镜像仓库地址"><a href="#4-选择合适的镜像仓库地址" class="headerlink" title="4. 选择合适的镜像仓库地址"></a>4. 选择合适的镜像仓库地址</h2><p>从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。</p>
<p>如果您使用的机器位于VPC网络，请使用 registry-vpc.cn-hangzhou.aliyuncs.com 作为Registry的域名登录。</p>
<h2 id="5-示例"><a href="#5-示例" class="headerlink" title="5. 示例"></a>5. 示例</h2><p>使用”docker tag”命令重命名镜像，并将它通过专有网络地址推送至Registry。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker images</span></span><br><span class="line">REPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">registry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB</span><br><span class="line"><span class="meta">$</span><span class="bash"> docker tag 37bb9c63c8b2 registry-vpc.cn-hangzhou.aliyuncs.com/acs/agent:0.7-dfb6816</span></span><br></pre></td></tr></table></figure>

<p>使用 “docker push” 命令将该镜像推送至远程。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker push registry-vpc.cn-hangzhou.aliyuncs.com/acs/agent:0.7-dfb6816</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="作业7-Redis"><a href="#作业7-Redis" class="headerlink" title="作业7 Redis"></a>作业7 Redis</h3><p>分片+高可用+负载均衡</p>
<p>这是一个三主三从的集群</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/06/21/135402.png" alt="image-20210621135359081"></p>
<ol>
<li><p>创建网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[akachi@AKACHI-PC-2018 dell]$ docker network create --driver bridge --gateway 192.114.7.15 --subnet 192.114.7.0/24 redisnet</span><br><span class="line">0320e12a36b17917fc16a16ebe2584ecf53e1a92cd8aece99c004626b28feea9</span><br></pre></td></tr></table></figure></li>
<li><p>创建配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">执行这个脚本创建配置文件</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /home/akachi/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /home/akachi/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; fatherakachi &gt;/home/akachi/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 192.114.7.$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">fatherakachi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li><p>创建 docker</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建redis</span></span><br><span class="line">for id in $(seq 1 6)</span><br><span class="line">do</span><br><span class="line">docker run -p 637$&#123;id&#125;:6379 -p 1637$&#123;id&#125;:16379 --name redis-$&#123;id&#125; \</span><br><span class="line">-v /home/akachi/redis/node-$&#123;id&#125;/data:/data \</span><br><span class="line">-v /home/akachi/redis/node-$&#123;id&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redisnet --ip 192.114.7.$&#123;id&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">移除失败的</span></span><br><span class="line">for id in $(seq 1 6); </span><br><span class="line">do </span><br><span class="line">docker rm -f redis-$&#123;id&#125;;</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>进入 docker1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\dell&gt;docker exec -it redis-1 /bin/sh</span><br><span class="line">/data #</span><br></pre></td></tr></table></figure></li>
<li><p>创建redis集群</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> redis-cli --cluster create 192.114.7.1:6379 192.114.7.2:6379 192.114.7.3:6379 192.114.7.4:6379 192.114.7.5:6379 192.114.7.6:6379 --cluster-replic</span><br><span class="line">as 1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 192.114.7.5:6379 to 192.114.7.1:6379</span><br><span class="line">Adding replica 192.114.7.6:6379 to 192.114.7.2:6379</span><br><span class="line">Adding replica 192.114.7.4:6379 to 192.114.7.3:6379</span><br><span class="line">M: d87b93316c2ed32a38bae18a09bb26343adc8cad 192.114.7.1:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 182a391d7956ff6a9acbda0fa386946de1b09020 192.114.7.2:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 9d6568bd86aa5f6b4a4d14cc5be2c7b0c1d677ac 192.114.7.3:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: dd813964879499ee1f6ef5395cb9b45e7d32a005 192.114.7.4:6379</span><br><span class="line">   replicates 9d6568bd86aa5f6b4a4d14cc5be2c7b0c1d677ac</span><br><span class="line">S: 7da7072595561b550096ba9e6b3ea93b91024887 192.114.7.5:6379</span><br><span class="line">   replicates d87b93316c2ed32a38bae18a09bb26343adc8cad</span><br><span class="line">S: 4df881acdcece81949615c8dc1ac1c1f9ba081c3 192.114.7.6:6379</span><br><span class="line">   replicates 182a391d7956ff6a9acbda0fa386946de1b09020</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing Cluster Check (using node 192.114.7.1:6379)</span></span><br><span class="line">M: d87b93316c2ed32a38bae18a09bb26343adc8cad 192.114.7.1:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 182a391d7956ff6a9acbda0fa386946de1b09020 192.114.7.2:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: dd813964879499ee1f6ef5395cb9b45e7d32a005 192.114.7.4:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 9d6568bd86aa5f6b4a4d14cc5be2c7b0c1d677ac</span><br><span class="line">S: 4df881acdcece81949615c8dc1ac1c1f9ba081c3 192.114.7.6:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 182a391d7956ff6a9acbda0fa386946de1b09020</span><br><span class="line">M: 9d6568bd86aa5f6b4a4d14cc5be2c7b0c1d677ac 192.114.7.3:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 7da7072595561b550096ba9e6b3ea93b91024887 192.114.7.5:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d87b93316c2ed32a38bae18a09bb26343adc8cad</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">/data #</span><br></pre></td></tr></table></figure></li>
<li><p>测试高可用性是否成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">连接集群</span></span><br><span class="line">redis-cli -c</span><br><span class="line"><span class="meta">#</span><span class="bash">查看集群信息</span></span><br><span class="line">127.0.0.1:6379&gt; cluster</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;cluster&#x27; command</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:601</span><br><span class="line">cluster_stats_messages_pong_sent:618</span><br><span class="line">cluster_stats_messages_sent:1219</span><br><span class="line">cluster_stats_messages_ping_received:613</span><br><span class="line">cluster_stats_messages_pong_received:601</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:1219</span><br><span class="line"><span class="meta">#</span><span class="bash">查看连接节点</span></span><br><span class="line"> cluster nodes</span><br><span class="line">182a391d7956ff6a9acbda0fa386946de1b09020 192.114.7.2:6379@16379 master - 0 1624264719541 2 connected 5461-10922</span><br><span class="line">dd813964879499ee1f6ef5395cb9b45e7d32a005 192.114.7.4:6379@16379 slave 9d6568bd86aa5f6b4a4d14cc5be2c7b0c1d677ac 0 1624264719041 4 connected</span><br><span class="line">4df881acdcece81949615c8dc1ac1c1f9ba081c3 192.114.7.6:6379@16379 slave 182a391d7956ff6a9acbda0fa386946de1b09020 0 1624264719541 6 connected</span><br><span class="line">9d6568bd86aa5f6b4a4d14cc5be2c7b0c1d677ac 192.114.7.3:6379@16379 master - 0 1624264719541 3 connected 10923-16383</span><br><span class="line">7da7072595561b550096ba9e6b3ea93b91024887 192.114.7.5:6379@16379 slave d87b93316c2ed32a38bae18a09bb26343adc8cad 0 1624264720044 5 connected</span><br><span class="line">d87b93316c2ed32a38bae18a09bb26343adc8cad 192.114.7.1:6379@16379 myself,master - 0 1624264718000 1 connected 0-5460</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span>一个数据</span></span><br><span class="line">set a b</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 192.114.7.3:6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash">到外部去关闭192.114.7.3这台机器</span></span><br><span class="line">docker stop redis redis-3</span><br><span class="line"><span class="meta">#</span><span class="bash">重新连接由于刚刚断了杀死的很可能是redis-3</span></span><br><span class="line">redis-cli -c</span><br><span class="line"><span class="meta">#</span><span class="bash">查看数据</span></span><br><span class="line"> get a</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 192.114.7.4:6379</span></span><br><span class="line">&quot;b&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">由7.4提供了服务</span></span><br><span class="line"><span class="meta">#</span><span class="bash">重新查看节点</span></span><br><span class="line">192.114.7.4:6379&gt; cluster nodes</span><br><span class="line">4df881acdcece81949615c8dc1ac1c1f9ba081c3 192.114.7.6:6379@16379 slave 182a391d7956ff6a9acbda0fa386946de1b09020 0 1624265161000 6 connected</span><br><span class="line">9d6568bd86aa5f6b4a4d14cc5be2c7b0c1d677ac 192.114.7.3:6379@16379 master,fail - 1624264870285 1624264869083 3 connected</span><br><span class="line">7da7072595561b550096ba9e6b3ea93b91024887 192.114.7.5:6379@16379 slave d87b93316c2ed32a38bae18a09bb26343adc8cad 0 1624265161556 5 connected</span><br><span class="line">d87b93316c2ed32a38bae18a09bb26343adc8cad 192.114.7.1:6379@16379 master - 0 1624265161000 1 connected 0-5460</span><br><span class="line">182a391d7956ff6a9acbda0fa386946de1b09020 192.114.7.2:6379@16379 master - 0 1624265161958 2 connected 5461-10922</span><br><span class="line">dd813964879499ee1f6ef5395cb9b45e7d32a005 192.114.7.4:6379@16379 myself,master - 0 1624265160000 8 connected 10923-16383</span><br><span class="line">192.114.7.4:6379&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash">我们发现node4变成了myself而 node3 变成了fial。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">高可用性集群测试成功</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="作业8-吧MessageService发布成docker镜像并且提交"><a href="#作业8-吧MessageService发布成docker镜像并且提交" class="headerlink" title="作业8 吧MessageService发布成docker镜像并且提交"></a>作业8 吧MessageService发布成docker镜像并且提交</h3><ol>
<li><p>创建Dockerfile</p>
<p>需求:</p>
<ul>
<li>定义开放5566端口</li>
<li>设定日志文挂载卷</li>
<li>Dockerfile文件创建再src同级目录下也就是项目的根目录在这里就是gqy-vis-ms目录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:11-jre-slim</span><br><span class="line">MAINTAINER akachi&lt;zsts@hotmail.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">COPY target/gqy-vis-ms-0.0.1-SNAPSHOT.jar gqy-vis-ms-0.0.1-SNAPSHOT.jar</span><br><span class="line">COPY /src/main/resources/application.properties application.properties</span><br><span class="line">COPY /src/main/resources/application-dev.properties application-dev.properties</span><br><span class="line"></span><br><span class="line">EXPOSE 5566</span><br><span class="line">ENTRYPOINT [&quot;/bin/bash&quot;]</span><br><span class="line">ENTRYPOINT [&quot;chmod&quot;,&quot;/usr/local/logs&quot;]</span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;gqy-vis-ms-0.0.1-SNAPSHOT.jar&quot;]</span><br></pre></td></tr></table></figure></li>
<li><p>构建docker</p>
<ul>
<li><p>通过windows docker找到仓库</p>
<p><img src="https://raw.githubusercontent.com/akachi10/notes/master/pic/2021/06/21/173228.png" alt="image-20210621173225830"></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">到达对应目录</span></span><br><span class="line">cd D:\idea_workspace\vis-nbga-parent\gqy-vis-ms&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash">构建镜像</span></span><br><span class="line">D:\idea_workspace\vis-nbga-parent\gqy-vis-ms&gt;docker build -t 192.168.2.129:5000/web-socker-message-service:1.0 .</span><br><span class="line">[+] Building 21.8s (11/11) FINISHED</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                               0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 508B                                                                               0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                  0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                    0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/openjdk:11-jre-slim                                            21.1s</span><br><span class="line"> =&gt; [1/6] FROM docker.io/library/openjdk:11-jre-slim@sha256:b4cb057e8e7f534c3ae279b5f3205e28d6520c0bdb1f80bbf61c0  0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                  0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 355B                                                                                  0.0s</span><br><span class="line"> =&gt; CACHED [2/6] WORKDIR @MYPATH                                                                                   0.0s</span><br><span class="line"> =&gt; [3/6] COPY target/gqy-vis-ms-0.0.1-SNAPSHOT.jar gqy-vis-ms-0.0.1-SNAPSHOT.jar                                  0.1s</span><br><span class="line"> =&gt; [4/6] COPY exe/start.sh start.sh                                                                               0.1s</span><br><span class="line"> =&gt; [5/6] COPY /src/main/resources/application.properties application.properties                                   0.1s</span><br><span class="line"> =&gt; [6/6] COPY /src/main/resources/application-dev.properties application-dev.properties                           0.1s</span><br><span class="line"> =&gt; exporting to image                                                                                             0.3s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                            0.2s</span><br><span class="line"> =&gt; =&gt; writing image sha256:c2423248540cf2a54d890e40290f8d308db62c9db94d9cf6bb8e7528e17b1b0e                       0.0s</span><br><span class="line"> =&gt; =&gt; naming to 192.168.2.129:5000/web-socker-message-service:1.0</span><br></pre></td></tr></table></figure></li>
<li><p>测试启动镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5577:5566 --name ms01 192.168.2.129:5000/web-socker-message-service:1.0</span><br></pre></td></tr></table></figure></li>
<li><p>发布镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 192.168.2.129:5000/web-socker-message-service:1.0</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Swarm"><a href="#Swarm" class="headerlink" title="Swarm"></a>Swarm</h3><p>单独在</p>
<h3 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h3><h3 id="jenkins"><a href="#jenkins" class="headerlink" title="jenkins"></a>jenkins</h3><h3 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI-CD"></a>CI-CD</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Akachi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://artificial-deus.github.io/2021/08/01/docker/docker/">https://artificial-deus.github.io/2021/08/01/docker/docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/">容器化</a><a class="post-meta__tags" href="/tags/docker/">docker</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/akachi10/blog-pic/main/5.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/08/03/docker/swarm%E9%9B%86%E7%BE%A4/"><img class="prev-cover" src="https://raw.githubusercontent.com/akachi10/blog-pic/main/6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Docker swarm集群</div></div></a></div><div class="next-post pull-right"><a href="/2021/07/28/Spring/Spring-%E4%BA%8B%E5%8A%A1/"><img class="next-cover" src="https://raw.githubusercontent.com/akachi10/blog-pic/main/2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Spring 事务</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/09/12/mysql/%E5%9F%BA%E4%BA%8Eswarm%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BAmysql%E4%B8%BB%E5%A4%87/" title="基于swarm集群搭建mysql主备"><img class="cover" src="https://raw.githubusercontent.com/akachi10/blog-pic/main/8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-12</div><div class="title">基于swarm集群搭建mysql主备</div></div></a></div><div><a href="/2021/08/03/docker/swarm%E9%9B%86%E7%BE%A4/" title="Docker swarm集群"><img class="cover" src="https://raw.githubusercontent.com/akachi10/blog-pic/main/6.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-03</div><div class="title">Docker swarm集群</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">docker 学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90"><span class="toc-number">1.1.1.</span> <span class="toc-text">资源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#linux%E5%AE%89%E8%A3%85-ubuntu"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">linux安装 ubuntu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#windows%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">windows安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%94%E8%AE%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">卸载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8A%A0%E9%80%9F%E5%99%A8"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">使用加速器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">docker 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8hello%E6%97%B6%E7%B3%BB%E7%BB%9F%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88"><span class="toc-number">1.2.1.</span> <span class="toc-text">调用hello时系统做了什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="toc-number">1.2.2.</span> <span class="toc-text">docker 是怎么工作的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%AF%94VM%E5%BF%AB"><span class="toc-number">1.2.3.</span> <span class="toc-text">docker 为什么比VM快</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E4%B8%AD%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.</span> <span class="toc-text">docker中的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E5%88%86%E5%B1%82%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.3.1.</span> <span class="toc-text">docker 分层下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E4%B8%AD%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">docker中的镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDEA-docker-%E6%8F%92%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">IDEA docker 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AFdocker-%E7%9A%84TCP%E6%8E%A7%E5%88%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">开启docker 的TCP控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IDEA%E4%B8%AD%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.2.</span> <span class="toc-text">IDEA中配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E6%88%90maven%E6%8F%92%E4%BB%B6"><span class="toc-number">1.4.3.</span> <span class="toc-text">集成maven插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">1.5.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.1.</span> <span class="toc-text">资源地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E6%A6%82%E5%BF%B5"><span class="toc-number">1.5.2.</span> <span class="toc-text">名词概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">1.5.3.</span> <span class="toc-text">小技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.4.</span> <span class="toc-text">命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">镜像命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-images"><span class="toc-number">1.5.4.1.1.</span> <span class="toc-text">docker images</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-search"><span class="toc-number">1.5.4.1.2.</span> <span class="toc-text">docker search</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-pull"><span class="toc-number">1.5.4.1.3.</span> <span class="toc-text">docker pull</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-rm-rmi"><span class="toc-number">1.5.4.1.4.</span> <span class="toc-text">docker rm rmi</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-history"><span class="toc-number">1.5.4.1.5.</span> <span class="toc-text">docker history</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-tag-%E9%87%8D%E5%91%BD%E5%90%8D%E9%95%9C%E5%83%8F"><span class="toc-number">1.5.4.1.6.</span> <span class="toc-text">docker tag 重命名镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-save"><span class="toc-number">1.5.4.1.7.</span> <span class="toc-text">docker save</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-load"><span class="toc-number">1.5.4.1.8.</span> <span class="toc-text">docker load</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-import"><span class="toc-number">1.5.4.1.9.</span> <span class="toc-text">docker import</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">容器命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-run"><span class="toc-number">1.5.4.2.1.</span> <span class="toc-text">docker run</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-ps"><span class="toc-number">1.5.4.2.2.</span> <span class="toc-text">docker ps</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Ctrl-P-Q"><span class="toc-number">1.5.4.2.3.</span> <span class="toc-text">Ctrl+P+Q</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-rm"><span class="toc-number">1.5.4.2.4.</span> <span class="toc-text">docker rm</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-start-amp-restart-amp-kill-amp-stop"><span class="toc-number">1.5.4.2.5.</span> <span class="toc-text">docker start &amp; restart &amp; kill &amp; stop</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-stats"><span class="toc-number">1.5.4.2.6.</span> <span class="toc-text">docker stats</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-export"><span class="toc-number">1.5.4.2.7.</span> <span class="toc-text">docker export</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">常用的其他命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-run-1"><span class="toc-number">1.5.4.3.1.</span> <span class="toc-text">docker run</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-logs"><span class="toc-number">1.5.4.3.2.</span> <span class="toc-text">docker logs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-top"><span class="toc-number">1.5.4.3.3.</span> <span class="toc-text">docker top</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-inspect"><span class="toc-number">1.5.4.3.4.</span> <span class="toc-text">docker inspect</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-exec-amp-docker-attach"><span class="toc-number">1.5.4.3.5.</span> <span class="toc-text">docker exec &amp; docker attach</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-cp"><span class="toc-number">1.5.4.3.6.</span> <span class="toc-text">docker cp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-login"><span class="toc-number">1.5.4.3.7.</span> <span class="toc-text">docker login</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%97%E8%A1%A8"><span class="toc-number">1.5.4.3.7.1.</span> <span class="toc-text">问题列表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.4.4.</span> <span class="toc-text">打包命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-commit"><span class="toc-number">1.5.4.4.1.</span> <span class="toc-text">docker commit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dockers-build"><span class="toc-number">1.5.4.4.2.</span> <span class="toc-text">dockers build</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-network-inspect"><span class="toc-number">1.5.4.4.3.</span> <span class="toc-text">docker network inspect</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-network-create"><span class="toc-number">1.5.4.4.4.</span> <span class="toc-text">docker network create</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-network-remove-thenet"><span class="toc-number">1.5.4.4.5.</span> <span class="toc-text">docker network remove thenet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-network-connect"><span class="toc-number">1.5.4.4.6.</span> <span class="toc-text">docker network connect</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bdocker%E4%BB%93%E5%BA%93"><span class="toc-number">1.5.4.5.</span> <span class="toc-text">查看docker仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E5%A4%87%E6%B3%A8"><span class="toc-number">1.5.4.6.</span> <span class="toc-text">命令备注</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker%E5%91%BD%E4%BB%A4%E5%9B%BE"><span class="toc-number">1.5.4.6.1.</span> <span class="toc-text">docker命令图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.5.</span> <span class="toc-text">容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">什么是容器数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">具名挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">匿名挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%86%B5"><span class="toc-number">1.5.5.4.</span> <span class="toc-text">概况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5"><span class="toc-number">1.5.5.5.</span> <span class="toc-text">特殊情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9AMySQL%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.5.6.</span> <span class="toc-text">多MySQL同步数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">1.5.6.</span> <span class="toc-text">docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9Clink"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">连接网络link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dockers%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">dockers网络原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84tomcat"><span class="toc-number">1.5.6.3.</span> <span class="toc-text">测试一个自己的tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">1.5.6.4.</span> <span class="toc-text">网络连通</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerFile"><span class="toc-number">1.5.7.</span> <span class="toc-text">dockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86dockerFile"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">初步认识dockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#dockerFile-%E6%9E%84%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.5.7.1.1.</span> <span class="toc-text">dockerFile 构建步骤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DockerFile-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.7.1.2.</span> <span class="toc-text">DockerFile 命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.5.7.1.3.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">1.5.7.1.4.</span> <span class="toc-text">练习</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95CMD"><span class="toc-number">1.5.7.1.4.1.</span> <span class="toc-text">测试CMD</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95ENTRYPOINT"><span class="toc-number">1.5.7.1.4.2.</span> <span class="toc-text">测试ENTRYPOINT</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">发布自己的镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E9%95%9C%E5%83%8F%E5%90%8D"><span class="toc-number">1.5.7.3.</span> <span class="toc-text">常用的镜像名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Compose"><span class="toc-number">1.5.8.</span> <span class="toc-text">Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#linux%E5%AE%89%E8%A3%85docker-compose"><span class="toc-number">1.5.8.1.</span> <span class="toc-text">linux安装docker compose</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%93%E9%AA%8C"><span class="toc-number">1.5.8.2.</span> <span class="toc-text">体验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2"><span class="toc-number">1.5.8.3.</span> <span class="toc-text">停止</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.8.4.</span> <span class="toc-text">配置解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#worldpress"><span class="toc-number">1.5.8.5.</span> <span class="toc-text">worldpress</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E4%B8%80%E4%B8%AAspring-boot-%E5%A4%8D%E5%88%BB%E4%BB%A5%E4%B8%8B%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">1.5.8.6.</span> <span class="toc-text">写一个spring boot 复刻以下计数器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Swarm"><span class="toc-number">1.5.9.</span> <span class="toc-text">Docker Swarm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockers-Stack"><span class="toc-number">1.5.10.</span> <span class="toc-text">Dockers Stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Secret"><span class="toc-number">1.5.11.</span> <span class="toc-text">Docker Secret</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Config"><span class="toc-number">1.5.12.</span> <span class="toc-text">Docker  Config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.13.</span> <span class="toc-text">可视化工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Portainer"><span class="toc-number">1.5.13.1.</span> <span class="toc-text">Portainer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rancher"><span class="toc-number">1.5.13.2.</span> <span class="toc-text">Rancher</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.6.</span> <span class="toc-text">符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A"><span class="toc-number">1.7.</span> <span class="toc-text">作业</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A1"><span class="toc-number">1.7.1.</span> <span class="toc-text">作业1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A2"><span class="toc-number">1.7.2.</span> <span class="toc-text">作业2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A3"><span class="toc-number">1.7.3.</span> <span class="toc-text">作业3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A4"><span class="toc-number">1.7.4.</span> <span class="toc-text">作业4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A5-Dockerfile-tomcat"><span class="toc-number">1.7.5.</span> <span class="toc-text">作业5 Dockerfile tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%956-%E5%9C%A8%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%AD%E4%B8%8A%E4%BC%A0docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.6.</span> <span class="toc-text">测试6 在阿里云镜像服务器中上传docker镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%99%BB%E5%BD%95%E9%98%BF%E9%87%8C%E4%BA%91Docker-Registry"><span class="toc-number">1.8.</span> <span class="toc-text">1. 登录阿里云Docker Registry</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%8ERegistry%E4%B8%AD%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.</span> <span class="toc-text">2. 从Registry中拉取镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%B0%86%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0Registry"><span class="toc-number">1.10.</span> <span class="toc-text">3. 将镜像推送到Registry</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80"><span class="toc-number">1.11.</span> <span class="toc-text">4. 选择合适的镜像仓库地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.12.</span> <span class="toc-text">5. 示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A7-Redis"><span class="toc-number">1.12.1.</span> <span class="toc-text">作业7 Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A8-%E5%90%A7MessageService%E5%8F%91%E5%B8%83%E6%88%90docker%E9%95%9C%E5%83%8F%E5%B9%B6%E4%B8%94%E6%8F%90%E4%BA%A4"><span class="toc-number">1.12.2.</span> <span class="toc-text">作业8 吧MessageService发布成docker镜像并且提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swarm"><span class="toc-number">1.12.3.</span> <span class="toc-text">Swarm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#compose"><span class="toc-number">1.12.4.</span> <span class="toc-text">compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins"><span class="toc-number">1.12.5.</span> <span class="toc-text">jenkins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CI-CD"><span class="toc-number">1.12.6.</span> <span class="toc-text">CI-CD</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://raw.githubusercontent.com/akachi10/blog-pic/main/5.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Akachi</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '413261098f0d1fc4c7fe',
      clientSecret: '7b01f9f497ef8a14cf8d77449d4e348b9beb153a',
      repo: 'artificial-deus.github.io',
      owner: 'artificial-deus',
      admin: ['akachi10'],
      id: '7141eba05c28effe99b162efcc9650df',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>